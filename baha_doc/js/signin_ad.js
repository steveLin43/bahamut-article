(function(i,r,g,s){var p={video:"/1017768/AD_mobileweb_signin_videorewarded"},u=!1,l,d,f=!1,c=!0,h=0,m=5e3,t,n={antiAdBlock:function(){r("body").append(r("<div/>").addClass("afs_ads").html("ads"));var a=!0,e=r(".afs_ads").eq(0);return(e===s||e.text().length===0||e.height()===0)&&(Dialogify.alert("\u7531\u65BC\u64CB\u5EE3\u544A\u63D2\u4EF6\u6703\u5F71\u97FF\u64AD\u653E\u5668\u904B\u4F5C\uFF0C\u5982\u679C\u60A8\u6709\u5B89\u88DD\uFF0C\u8ACB\u60A8\u5C07 gamer.com.tw / bahamut.com.tw \u7DB2\u57DF\u52A0\u5165\u767D\u540D\u55AE\u6216\u8003\u616E\u95DC\u9589\u63D2\u4EF6\uFF0C\u5DF4\u54C8\u59C6\u7279\u611F\u8B1D\u60A8\u7684\u652F\u6301\uFF01"),a=!1),r(".afs_ads").remove(),a},initAd:function(){if(u===!0)return!1;var a=i.Bahamut||{};typeof a.Csrf<"u"&&(t=new a.Csrf),googletag.pubads().enableAsyncRendering(),googletag.enableServices(),googletag.pubads().addEventListener("slotRenderEnded",function(e){e.slot===d&&(e.isEmpty?(l&&l.close(),n.loadingFail()):h=setTimeout(function(){l&&l.close(),n.loadingFail(),c=!1},m))}),googletag.pubads().addEventListener("rewardedSlotReady",function(e){if(e.slot===d){if(c===!1)return!1;clearTimeout(h),l&&l.close(),Dialogify.confirm("\u662F\u5426\u89C0\u770B\u5EE3\u544A\uFF1F",{ok:function(){Dialogify.closeAll(),i.onbeforeunload=function(){return"\u73FE\u5728\u96E2\u958B\u9801\u9762\u5C07\u7121\u6CD5\u5F97\u5230\u734E\u52F5\uFF0C\u662F\u5426\u78BA\u5B9A\u96E2\u958B\u9801\u9762\uFF1F"},e.makeRewardedVisible()}})}}),googletag.pubads().addEventListener("rewardedSlotGranted",function(e){e.slot===d&&(i.onbeforeunload=null,n.setFinishAd())}),googletag.pubads().addEventListener("rewardedSlotClosed",function(e){e.slot===d&&(i.onbeforeunload=null,n.finishAd())}),u=!0},startAd:function(){if(n.antiAdBlock()===!1||!User.Login.requireLogin())return!1;if(t===s)return Dialogify.alert("\u767C\u751F\u932F\u8AA4\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u5617\u8A66(1)"),!1;t.setCookie(),r.ajax({url:"https://api.gamer.com.tw/mobile_app/bahamut/v1/sign_in_ad_start.php",method:"POST",headers:t.getJqueryHeaders(),dataType:"json",xhrFields:{withCredentials:!0}}).done(function(a){if(a.error!==s)return g.errorHandler()(a.error),!1;var e=parseInt(a.data.finished,10);if(e===1){Dialogify.alert("\u60A8\u4ECA\u5929\u5DF2\u7D93\u5F97\u5230\u904E\u96D9\u500D\u5DF4\u5E63\u734E\u52F5\u56C9\uFF01");var o=r(".popup-dailybox__btn");return o.length!==0&&(o.attr("disabled",""),o.text("\u9818\u53D6\u96D9\u500D\u5DF4\u5E63"),o.removeAttr("onclick"),f=!0),!1}f=!1,n.Player.videoByReward()}).fail(function(){Dialogify.alert("\u7531\u65BC\u64CB\u5EE3\u544A\u63D2\u4EF6\u6703\u5F71\u97FF\u64AD\u653E\u5668\u904B\u4F5C\uFF0C\u5982\u679C\u60A8\u6709\u5B89\u88DD\uFF0C\u8ACB\u60A8\u5C07 gamer.com.tw / bahamut.com.tw \u7DB2\u57DF\u52A0\u5165\u767D\u540D\u55AE\u6216\u8003\u616E\u95DC\u9589\u63D2\u4EF6\uFF0C\u798F\u5229\u793E\u611F\u8B1D\u60A8\u7684\u652F\u6301\uFF01")})},setFinishAd:function(){if(t===s)return Dialogify.alert("\u767C\u751F\u932F\u8AA4\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u5617\u8A66(2)"),!1;t.setCookie(),r.ajax({url:"https://api.gamer.com.tw/mobile_app/bahamut/v1/sign_in_ad_finished.php",method:"POST",headers:t.getJqueryHeaders(),dataType:"json",xhrFields:{withCredentials:!0}}).done(function(a){a.data!==s&&parseInt(a.data.finished,10)===1&&(f=!0,i.Signin.finishAd())})},finishAd:function(){if(!User.Login.requireLogin())return!1;if(f===!1)return setTimeout(i.SigninAd.finishAd,100),!1;if(f=!1,t===s)return Dialogify.alert("\u767C\u751F\u932F\u8AA4\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u5617\u8A66(2)"),!1;t.setCookie(),r.ajax({url:"https://api.gamer.com.tw/mobile_app/bahamut/v1/sign_in_ad_finished.php",method:"POST",dataType:"json",headers:t.getJqueryHeaders(),xhrFields:{withCredentials:!0}}).done(function(a){if(a.error!==s)return g.errorHandler()(a.error),!1;var e=parseInt(a.data.finished,10);e===1?Dialogify.alert("\u89C0\u770B\u5EE3\u544A\u5B8C\u6210\uFF0C\u7372\u5F97\u96D9\u500D\u5DF4\u5E63\u734E\u52F5\u3002"):Dialogify.alert("\u60A8\u4ECA\u5929\u5DF2\u7D93\u5F97\u5230\u904E\u96D9\u500D\u5DF4\u5E63\u734E\u52F5\u56C9\uFF01");var o=r(".popup-dailybox__btn");o.length!==0&&(o.attr("disabled",""),o.text("\u9818\u53D6\u96D9\u500D\u5DF4\u5E63"),o.removeAttr("onclick"))}).fail(function(){Dialogify.alert("\u7531\u65BC\u64CB\u5EE3\u544A\u63D2\u4EF6\u6703\u5F71\u97FF\u64AD\u653E\u5668\u904B\u4F5C\uFF0C\u5982\u679C\u60A8\u6709\u5B89\u88DD\uFF0C\u8ACB\u60A8\u5C07 gamer.com.tw / bahamut.com.tw \u7DB2\u57DF\u52A0\u5165\u767D\u540D\u55AE\u6216\u8003\u616E\u95DC\u9589\u63D2\u4EF6\uFF0C\u798F\u5229\u793E\u611F\u8B1D\u60A8\u7684\u652F\u6301\uFF01")})},loadingFail:function(){Dialogify.alert('\u5EE3\u544A\u7121\u6CD5\u64AD\u653E\uFF0C<a href="https://user.gamer.com.tw/help/detail.php?sn=401" target="_blank">\u77AD\u89E3\u66F4\u591A</a>\u3002')}};typeof i.googletag>"u"&&(i.googletag={cmd:[]}),i.googletag.cmd.push(n.initAd);var v={videoByReward:function(){l=new Dialogify('<div class="fuli-ads"><p class="fuli-ad__loading">\u5EE3\u544A\u8F09\u5165\u4E2D</p></div>',{closable:!1,dialog:{className:"dialogify__adsPopup"}}),l.showModal(),googletag.destroySlots([d]),d=googletag.defineOutOfPageSlot(p.video,googletag.enums.OutOfPageFormat.REWARDED).addService(googletag.pubads()),googletag.display(d)}};i.SigninAd=n,i.SigninAd.Player=v})(window,jQuery,Util);