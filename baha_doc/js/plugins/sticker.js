var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __publicField=(obj,key,value)=>(__defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value),__accessCheck=(obj,member,msg)=>{if(!member.has(obj))throw TypeError("Cannot "+msg)};var __privateGet=(obj,member,getter)=>(__accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj)),__privateAdd=(obj,member,value)=>{if(member.has(obj))throw TypeError("Cannot add the same private member more than once");member instanceof WeakSet?member.add(obj):member.set(obj,value)},__privateSet=(obj,member,value,setter)=>(__accessCheck(obj,member,"write to private field"),setter?setter.call(obj,value):member.set(obj,value),value);var __privateMethod=(obj,member,method)=>(__accessCheck(obj,member,"access private method"),method);(($,window2,Dialogify,undefined)=>{"use strict";var _options,_$tippyElement,_editorInfoCallable,_gifSearchRequestAbortController,_gifSearchColumnHeights,_gifFeaturedColumnHeights,_gifSearchTimer,_gifLastSearchValue,_bindEvents,bindEvents_fn,_createTippy,createTippy_fn,_showTab,showTab_fn,_getInsertType,getInsertType_fn,_insertEmoticon,insertEmoticon_fn,_insertGif,insertGif_fn,_insertSticker,insertSticker_fn,_insertText,insertText_fn,_insertHtml,insertHtml_fn,_fetchTenorFeatured,fetchTenorFeatured_fn,_setFeaturedGifTabContent,setFeaturedGifTabContent_fn,_setSearchGifTabContent,setSearchGifTabContent_fn,_setStickerTabContent,setStickerTabContent_fn,_searchTenor,searchTenor_fn,_getTippyInstance,getTippyInstance_fn,_getLastTabIndex,getLastTabIndex_fn,_setLastTabIndex,setLastTabIndex_fn,_sortByHeight,sortByHeight_fn,_fetchSticker,fetchSticker_fn,_prependStickerHistory,prependStickerHistory_fn,_detectTheme,detectTheme_fn,_stickerHtml,stickerHtml_fn,_stickerListItemHtml,stickerListItemHtml_fn;const TENOR_SEARCH_API="https://tenor.googleapis.com/v2/search",TENOR_FEATURED_API="https://tenor.googleapis.com/v2/featured",TENOR_REGISTER_SHARE_API="https://tenor.googleapis.com/v2/registershare",TENOR_PARAMS=new URLSearchParams;TENOR_PARAMS.append("key",""),TENOR_PARAMS.append("locale",""),TENOR_PARAMS.append("country",""),TENOR_PARAMS.append("contentfilter","off"),TENOR_PARAMS.append("media_filter","tinygif,gif");const GIF_COLUMN_WIDTH=155,GIF_COLUMN_COUNT=2,GIF_TINY_WIDTH=220,GIF_DISPLAY_WIDTH=147,DEFAULT_LAST_TAB_KEY="STICKER_last_tab",STICKER_HISTORY_KEY="hahamut_stickered",_Sticker=class _Sticker{constructor(tippyTarget,editorInfoCallable,options){__privateAdd(this,_bindEvents);__privateAdd(this,_createTippy);__privateAdd(this,_showTab);__privateAdd(this,_getInsertType);__privateAdd(this,_insertEmoticon);__privateAdd(this,_insertGif);__privateAdd(this,_insertSticker);__privateAdd(this,_insertText);__privateAdd(this,_insertHtml);__privateAdd(this,_fetchTenorFeatured);__privateAdd(this,_setFeaturedGifTabContent);__privateAdd(this,_setSearchGifTabContent);__privateAdd(this,_setStickerTabContent);__privateAdd(this,_searchTenor);__privateAdd(this,_getTippyInstance);__privateAdd(this,_getLastTabIndex);__privateAdd(this,_setLastTabIndex);__privateAdd(this,_sortByHeight);__privateAdd(this,_fetchSticker);__privateAdd(this,_prependStickerHistory);__privateAdd(this,_detectTheme);__privateAdd(this,_stickerHtml);__privateAdd(this,_stickerListItemHtml);__privateAdd(this,_options,void 0);__privateAdd(this,_$tippyElement,void 0);__privateAdd(this,_editorInfoCallable,void 0);__privateAdd(this,_gifSearchRequestAbortController,null);__privateAdd(this,_gifSearchColumnHeights,[]);__privateAdd(this,_gifFeaturedColumnHeights,[]);__privateAdd(this,_gifSearchTimer,null);__privateAdd(this,_gifLastSearchValue,"");__privateSet(this,_editorInfoCallable,editorInfoCallable),__privateSet(this,_options,options||{}),__privateSet(this,_$tippyElement,$(TIPPY_HTML));for(let i=0;i<GIF_COLUMN_COUNT;i++)__privateGet(this,_gifSearchColumnHeights)[i]=[i,0],__privateGet(this,_gifFeaturedColumnHeights)[i]=[i,0];__privateMethod(this,_detectTheme,detectTheme_fn).call(this),__privateMethod(this,_bindEvents,bindEvents_fn).call(this),__privateMethod(this,_createTippy,createTippy_fn).call(this,tippyTarget)}showEmoticonTab($tab){__privateMethod(this,_showTab,showTab_fn).call(this,$tab)}async showGifTab($tab){if(__privateMethod(this,_showTab,showTab_fn).call(this,$tab),$tab.find(".post__gif__item").length==0)try{const json=await __privateMethod(this,_fetchTenorFeatured,fetchTenorFeatured_fn).call(this);__privateMethod(this,_setFeaturedGifTabContent,setFeaturedGifTabContent_fn).call(this,json)}catch(reason){Dialogify.alert(reason)}}async showStickerTab($tab){if(__privateMethod(this,_showTab,showTab_fn).call(this,$tab),$tab.find(".sticker-list__item").length==0)try{const json=await __privateMethod(this,_fetchSticker,fetchSticker_fn).call(this);__privateMethod(this,_setStickerTabContent,setStickerTabContent_fn).call(this,json)}catch(reason){Dialogify.alert(reason)}}static bindContentStickerClick(options){$(options.contentElement).on("click",'img[src^="https://im.bahamut.com.tw/sticker/"]',function(){let matches=this.src.match(/^https:\/\/im\.bahamut\.com\.tw\/sticker\/(\d+)\//);if(options.isApp){let stickerInfo={id:+matches[1],url:this.src};typeof options.metaData=="function"&&options.metaData(this).forEach((value,key,map)=>{stickerInfo[key]=value}),BahamutJs.clickSticker(JSON.stringify(stickerInfo))}else window2.open(`https://home.gamer.com.tw/sticker_detail.php?sticker=${matches[1]}`)})}};_options=new WeakMap,_$tippyElement=new WeakMap,_editorInfoCallable=new WeakMap,_gifSearchRequestAbortController=new WeakMap,_gifSearchColumnHeights=new WeakMap,_gifFeaturedColumnHeights=new WeakMap,_gifSearchTimer=new WeakMap,_gifLastSearchValue=new WeakMap,_bindEvents=new WeakSet,bindEvents_fn=function(){__privateGet(this,_$tippyElement).find(".tab-menu a").on("click",e=>{let $listItem=$(e.target).parent("li");if($listItem.hasClass("active"))return;let index=$listItem.index();__privateGet(this,_$tippyElement).find(".tab-content").eq(index).triggerHandler("shown")}),__privateGet(this,_$tippyElement).find(".tab-content").on("shown",e=>{let $tab=$(e.target),index=$tab.index();switch(index){case 1:this.showEmoticonTab($tab);break;case 2:this.showGifTab($tab);break;case 3:this.showStickerTab($tab);break;default:}__privateMethod(this,_setLastTabIndex,setLastTabIndex_fn).call(this,index)}),__privateGet(this,_$tippyElement).find(".gif-wall").on("scroll",async e=>{let $gifWall=$(e.target),$elem=$gifWall.find($gifWall.find(".trending-gif").is(":visible")?".trending-gif":".search-gif");if($elem.height()-250-$gifWall.scrollTop()<=500){let next=$elem.data("next");if(!$elem.data("loading"))if($elem.data("loading","1"),$elem.hasClass("trending-gif")){const json=await __privateMethod(this,_fetchTenorFeatured,fetchTenorFeatured_fn).call(this,next);__privateMethod(this,_setFeaturedGifTabContent,setFeaturedGifTabContent_fn).call(this,json,next)}else{let query=$elem.data("query");const json=await __privateMethod(this,_searchTenor,searchTenor_fn).call(this,query,next);__privateMethod(this,_setSearchGifTabContent,setSearchGifTabContent_fn).call(this,json,query,next)}}else $elem.removeData("loading")}),__privateGet(this,_$tippyElement).find(".gif-search-input").on("input",e=>{__privateGet(this,_gifSearchTimer)!==null&&clearTimeout(__privateGet(this,_gifSearchTimer));let $searchInput=$(e.target),$tab=$searchInput.parents(".tab-content_gif"),searchValue=$searchInput.val().trim();$searchInput.val()?($searchInput.prev(".clearall").addClass("is-active"),$tab.find(".trending-gif, .search-gif").hide(),$tab.find(".searching-gif").show()):$searchInput.prev(".clearall").removeClass("is-active"),searchValue.length>=1&&searchValue!==__privateGet(this,_gifLastSearchValue)?__privateSet(this,_gifSearchTimer,setTimeout(async()=>{const json=await __privateMethod(this,_searchTenor,searchTenor_fn).call(this,searchValue);__privateMethod(this,_setSearchGifTabContent,setSearchGifTabContent_fn).call(this,json,searchValue),__privateSet(this,_gifLastSearchValue,searchValue)},1e3)):searchValue==""?(__privateSet(this,_gifLastSearchValue,""),$tab.find(".searching-gif, .search-gif").hide(),$tab.find(".trending-gif").show()):($tab.find(".trending-gif, .searching-gif").hide(),$tab.find(".search-gif").show())}),__privateGet(this,_$tippyElement).find(".tab-content_gif .clearall").on("click",function(){$(this).removeClass("is-active").next("input").val("").triggerHandler("input")}),__privateGet(this,_$tippyElement).find(".tab-content_sticker").on("click",".sticker-index .tab-item",function(){let $stickerTabItem=$(this),slickIndex=$stickerTabItem.data("slick-index")||$stickerTabItem.parents(".slick-slide").data("slick-index");slickIndex!=0&&$stickerTabItem.parents(".sticker-wrapper").find(".sticker-list-content").slick("slickGoTo",slickIndex-1)}),__privateGet(this,_$tippyElement).find(".emotion-list").on("click","img",e=>{__privateMethod(this,_insertEmoticon,insertEmoticon_fn).call(this,e),__privateMethod(this,_getTippyInstance,getTippyInstance_fn).call(this).hide()}),__privateGet(this,_$tippyElement).find(".gif-wall").on("click","img",e=>{__privateMethod(this,_insertGif,insertGif_fn).call(this,e),__privateMethod(this,_getTippyInstance,getTippyInstance_fn).call(this).hide()}),__privateGet(this,_$tippyElement).find(".tab-content_sticker").on("click",".sticker-list__link img",e=>{__privateMethod(this,_insertSticker,insertSticker_fn).call(this,e),__privateMethod(this,_getTippyInstance,getTippyInstance_fn).call(this).hide()})},_createTippy=new WeakSet,createTippy_fn=function(tippyTarget){tippy.delegate(__privateGet(this,_options).delegateTargets||window2.document.body,{target:tippyTarget,allowHTML:!0,content:__privateGet(this,_$tippyElement).get(0),interactive:!0,trigger:"click",theme:__privateGet(this,_options).theme,maxWidth:"466px",appendTo:__privateGet(this,_options).appendTo||window2.document.body,onHidden:instance=>{instance.destroy()},onShow:instance=>{if(window2.User&&window2.User.Login&&!window2.User.Login.requireLoginIframe())return!1;let lastTab;switch(__privateGet(this,_options).showTab||__privateMethod(this,_getLastTabIndex,getLastTabIndex_fn).call(this)){case 2:lastTab=".tab-content_gif";break;case 3:lastTab=".tab-content_sticker";break;case 1:default:lastTab=".tab-content_emoji"}$(instance.popper).find(lastTab).triggerHandler("shown")}})},_showTab=new WeakSet,showTab_fn=function($tab){$tab.show().siblings(".tab-content").hide();let $tabs=$tab.parent().children(".tab-content");$tab.siblings(".tab-menu").children("li").removeClass("active").eq($tabs.index($tab)).addClass("active")},_getInsertType=new WeakSet,getInsertType_fn=function(which,insertType){return typeof insertType=="number"?insertType:insertType[which]||_Sticker.INSERT_TYPE_URL},_insertEmoticon=new WeakSet,insertEmoticon_fn=function(event){const tippyRef=__privateMethod(this,_getTippyInstance,getTippyInstance_fn).call(this).reference,editorInfo=__privateGet(this,_editorInfoCallable).call(this,tippyRef);let eid=event.target.dataset.eid,emoticonUrl=`https://i2.bahamut.com.tw/editor/emotion/${eid}.gif`;switch(__privateGet(this,_options).onInsert&&__privateGet(this,_options).onInsert.call&&__privateGet(this,_options).onInsert.call(this,tippyRef,emoticonUrl),__privateMethod(this,_getInsertType,getInsertType_fn).call(this,"emoticon",editorInfo.insertType)){case _Sticker.INSERT_TYPE_BAHARTE:$(bahaRte.isPlainText?bahaRte.source:bahaRte.win).focus(),bahaRte.toolbar.insertEmotion(event);break;case _Sticker.INSERT_TYPE_HTML:let html=`<img src="${emoticonUrl}">`;__privateMethod(this,_insertHtml,insertHtml_fn).call(this,editorInfo.editor,html);break;case _Sticker.INSERT_TYPE_URL:__privateMethod(this,_insertText,insertText_fn).call(this,editorInfo.editor,emoticonUrl);break;case _Sticker.INSERT_TYPE_CODE:let code=`[e${eid}]`;__privateMethod(this,_insertText,insertText_fn).call(this,editorInfo.editor,code);break;default:throw new Error("unknown insert type")}},_insertGif=new WeakSet,insertGif_fn=function(event){const tippyRef=__privateMethod(this,_getTippyInstance,getTippyInstance_fn).call(this).reference,editorInfo=__privateGet(this,_editorInfoCallable).call(this,tippyRef);let gifId=event.target.dataset.id,gifUrl=event.target.dataset.url;switch(__privateGet(this,_options).onInsert&&__privateGet(this,_options).onInsert.call&&__privateGet(this,_options).onInsert.call(this,tippyRef,gifUrl),__privateMethod(this,_getInsertType,getInsertType_fn).call(this,"gif",editorInfo.insertType)){case _Sticker.INSERT_TYPE_BAHARTE:$(bahaRte.isPlainText?bahaRte.source:bahaRte.win).focus(),bahaRte.toolbar.insertImage(event,gifUrl);break;case _Sticker.INSERT_TYPE_HTML:let html=`<img src="${gifUrl}">`;__privateMethod(this,_insertHtml,insertHtml_fn).call(this,editorInfo.editor,html);break;case _Sticker.INSERT_TYPE_URL:__privateMethod(this,_insertText,insertText_fn).call(this,editorInfo.editor,gifUrl);break;case _Sticker.INSERT_TYPE_CODE:let code=`[img=${gifUrl}]`;__privateMethod(this,_insertText,insertText_fn).call(this,editorInfo.editor,code);break;default:throw new Error("unknown insert type")}if(__privateGet(this,_$tippyElement).find(".search-gif:visible").length){const searchValue=__privateGet(this,_$tippyElement).find(".gif-search-input").val().trim(),params=new URLSearchParams(TENOR_PARAMS);params.delete("contentfilter"),params.delete("media_filter"),params.append("id",gifId),params.append("q",searchValue),fetch(TENOR_REGISTER_SHARE_API+"?"+params.toString())}},_insertSticker=new WeakSet,insertSticker_fn=function(event){const tippyRef=__privateMethod(this,_getTippyInstance,getTippyInstance_fn).call(this).reference,editorInfo=__privateGet(this,_editorInfoCallable).call(this,tippyRef);let stickerGroup=event.target.dataset.stickerGroup,stickerImage=event.target.dataset.stickerImage,stickerUrl=`https://im.bahamut.com.tw/sticker/${stickerGroup}/${stickerImage}.png`;switch(__privateGet(this,_options).onInsert&&__privateGet(this,_options).onInsert.call&&__privateGet(this,_options).onInsert.call(this,tippyRef,stickerUrl),__privateMethod(this,_getInsertType,getInsertType_fn).call(this,"sticker",editorInfo.insertType)){case _Sticker.INSERT_TYPE_BAHARTE:$(bahaRte.isPlainText?bahaRte.source:bahaRte.win).focus(),bahaRte.toolbar.insertImage(event,stickerUrl);break;case _Sticker.INSERT_TYPE_HTML:let html=`<img src="${stickerUrl}">`;__privateMethod(this,_insertHtml,insertHtml_fn).call(this,editorInfo.editor,html);break;case _Sticker.INSERT_TYPE_URL:__privateMethod(this,_insertText,insertText_fn).call(this,editorInfo.editor,stickerUrl);break;case _Sticker.INSERT_TYPE_CODE:let code=`[s${stickerGroup}_${stickerImage}]`;__privateMethod(this,_insertText,insertText_fn).call(this,editorInfo.editor,code);break;default:throw new Error("unknown insert type")}__privateMethod(this,_prependStickerHistory,prependStickerHistory_fn).call(this,stickerGroup,stickerImage)},_insertText=new WeakSet,insertText_fn=function(editor,text){text+=" ";let startPos=editor.selectionStart,start=editor.value.substring(0,startPos),end=editor.value.substring(editor.selectionEnd);editor.value=start+text+end,editor.focus(),editor.selectionStart=startPos+text.length,editor.selectionEnd=startPos+text.length},_insertHtml=new WeakSet,insertHtml_fn=function(editor,html){editor.execCommand("inserthtml",!1,html)},_fetchTenorFeatured=new WeakSet,fetchTenorFeatured_fn=async function(pos){if(pos==="")return Promise.reject(new Error);let params=new URLSearchParams(TENOR_PARAMS);return pos&&params.append("pos",pos),(await fetch(TENOR_FEATURED_API+"?"+params.toString())).json()},_setFeaturedGifTabContent=new WeakSet,setFeaturedGifTabContent_fn=function(json,pos){if(pos==undefined)for(let i=0;i<GIF_COLUMN_COUNT;i++)__privateGet(this,_gifFeaturedColumnHeights)[i]=[i,0];__privateGet(this,_$tippyElement).find(".trending-gif").data("next",json.next);for(let index=0;index<json.results.length;index++){let element=json.results[index],height=element.media_formats.tinygif.dims[1]*GIF_DISPLAY_WIDTH/GIF_TINY_WIDTH+8,left=__privateGet(this,_gifFeaturedColumnHeights)[0][0]*GIF_COLUMN_WIDTH,top=__privateGet(this,_gifFeaturedColumnHeights)[0][1];__privateGet(this,_$tippyElement).find(".trending-gif > div").append(`<div class="post__gif__item" style="height: ${height}px; left: ${left}px; top: ${top}px;">
                        <div><img data-url="${element.media_formats.gif.url}" data-id="${element.id}" data-src="${element.media_formats.tinygif.url}" class="lazyload"></div>
                    </div>`),__privateGet(this,_gifFeaturedColumnHeights)[0][1]+=__privateGet(this,_$tippyElement).find(".trending-gif > div > .post__gif__item").last().outerHeight(!0),__privateGet(this,_gifFeaturedColumnHeights).sort(__privateMethod(this,_sortByHeight,sortByHeight_fn)),__privateGet(this,_$tippyElement).find(".trending-gif > .masonry").height(__privateGet(this,_gifFeaturedColumnHeights)[GIF_COLUMN_COUNT-1][1]+"px")}},_setSearchGifTabContent=new WeakSet,setSearchGifTabContent_fn=function(json,query,pos){if(query!=__privateGet(this,_$tippyElement).find(".search-gif").data("query")||pos==""){__privateGet(this,_$tippyElement).find(".search-gif > .row").empty(),__privateSet(this,_gifSearchColumnHeights,[]);for(let i=0;i<GIF_COLUMN_COUNT;i++)__privateGet(this,_gifSearchColumnHeights)[i]=[i,0]}if(__privateGet(this,_$tippyElement).find(".searching-gif").hide(),__privateGet(this,_$tippyElement).find(".search-gif").data({query,next:json.next}).show(),json.results.length===0)__privateGet(this,_$tippyElement).find(".search-gif > div").append(`<div class="post__nogif__item">
                        <img src="https://i2.bahamut.com.tw/forum/empty_gif.png">
                    </div>`),__privateGet(this,_$tippyElement).find(".search-gif > .masonry").css("height","initial");else for(let index=0;index<json.results.length;index++){let element=json.results[index],height=element.media_formats.tinygif.dims[1]*GIF_DISPLAY_WIDTH/GIF_TINY_WIDTH+8,left=__privateGet(this,_gifSearchColumnHeights)[0][0]*GIF_COLUMN_WIDTH,top=__privateGet(this,_gifSearchColumnHeights)[0][1];__privateGet(this,_$tippyElement).find(".search-gif > div").append(`<div class="post__gif__item" style="height: ${height}px; left: ${left}px; top: ${top}px;">
                            <div><img data-url="${element.media_formats.gif.url}" data-id="${element.id}" data-src="${element.media_formats.tinygif.url}" class="lazyload"></div>
                        </div>`),__privateGet(this,_gifSearchColumnHeights)[0][1]+=__privateGet(this,_$tippyElement).find(".search-gif > div > .post__gif__item").last().outerHeight(!0),__privateGet(this,_gifSearchColumnHeights).sort(__privateMethod(this,_sortByHeight,sortByHeight_fn)),__privateGet(this,_$tippyElement).find(".search-gif > .masonry").height(__privateGet(this,_gifSearchColumnHeights)[GIF_COLUMN_COUNT-1][1]+"px")}},_setStickerTabContent=new WeakSet,setStickerTabContent_fn=function(json){let stickerData=[],stickerDetailData=[];Object.entries(json.data.list).forEach(([key,value])=>{stickerData[key]={sticker_order:value.order,sticker_start_time:value.start_time,sticker_visible:value.visible,ctime:0},stickerDetailData[key]=value.detail,value.detail.sticker_period==0?stickerDetailData[key].deadline=0:stickerDetailData[key].deadline=value.detail.sticker_period+value.start_time}),__privateGet(this,_$tippyElement).find(".tab-content_sticker").html(__privateMethod(this,_stickerHtml,stickerHtml_fn).call(this,stickerData,stickerDetailData)),__privateGet(this,_$tippyElement).find(".sticker-list-content").slick({lazyLoad:"ondemand",arrows:!1,draggable:!1,infinite:!1,fade:!0}).on("beforeChange",(event,slick,currentSlide,nextSlide)=>{__privateGet(this,_$tippyElement).find(".sticker-item").removeClass("is-active").eq(nextSlide+1).addClass("is-active")}).on("lazyLoaded",(event,slick,image,imageSource)=>{tippy(image[0],{allowHTML:!0,content:`<img src="${imageSource}" width="180">`,theme:__privateGet(this,_options).theme})});let shows=6;__privateGet(this,_$tippyElement).find(".sticker-index li").length<6&&(shows=__privateGet(this,_$tippyElement).find(".sticker-index li").length),__privateGet(this,_$tippyElement).find(".sticker-index").slick({infinite:!1,slidesToShow:shows,slidesToScroll:shows,asNavFor:".sticker-list-content"}),__privateMethod(this,_getTippyInstance,getTippyInstance_fn).call(this).popperInstance.update()},_searchTenor=new WeakSet,searchTenor_fn=async function(query,pos){if(__privateGet(this,_gifSearchRequestAbortController)!==null&&__privateGet(this,_gifSearchRequestAbortController).abort(),pos==="")return Promise.reject(new Error);let params=new URLSearchParams(TENOR_PARAMS);return params.append("q",query),pos!==undefined&&params.append("pos",pos),__privateSet(this,_gifSearchRequestAbortController,new AbortController),(await fetch(TENOR_SEARCH_API+"?"+params.toString(),{signal:__privateGet(this,_gifSearchRequestAbortController).signal})).json()},_getTippyInstance=new WeakSet,getTippyInstance_fn=function(){return __privateGet(this,_$tippyElement).parents("[data-tippy-root]").get(0)._tippy},_getLastTabIndex=new WeakSet,getLastTabIndex_fn=function(){let lastTabKey=__privateGet(this,_options).lastTabLocalStorageKey||DEFAULT_LAST_TAB_KEY;return+window2.localStorage.getItem(lastTabKey)},_setLastTabIndex=new WeakSet,setLastTabIndex_fn=function(index){let lastTabKey=__privateGet(this,_options).lastTabLocalStorageKey||DEFAULT_LAST_TAB_KEY;window2.localStorage.setItem(lastTabKey,String(index))},_sortByHeight=new WeakSet,sortByHeight_fn=function(a,b){return a[1]-b[1]||a[0]-b[0]},_fetchSticker=new WeakSet,fetchSticker_fn=async function(){const json=await(await fetch("https://api.gamer.com.tw/mobile_app/im/v1/my_sticker.php",{credentials:"include"})).json();return json.error?Promise.reject(new Error(json.error.message)):Promise.resolve(json)},_prependStickerHistory=new WeakSet,prependStickerHistory_fn=function(stickerGroup,stickerImage){let stickerHistory=JSON.parse(window2.localStorage.getItem(STICKER_HISTORY_KEY)||"[]");stickerHistory.forEach(function(data,index){data.sticker_group==stickerGroup&&data.sticker_img==stickerImage&&stickerHistory.splice(index,1)}),stickerHistory.length>=16&&stickerHistory.pop(),stickerHistory.unshift({sticker_group:stickerGroup,sticker_img:stickerImage});let historyHtml="";stickerHistory.forEach(data=>{historyHtml+=__privateMethod(this,_stickerListItemHtml,stickerListItemHtml_fn).call(this,data.sticker_group,data.sticker_img)}),__privateGet(this,_$tippyElement).find('.slick-slide[data-slick-index="0"] .sticker-list.row').html(historyHtml),__privateGet(this,_$tippyElement).find(".sticker-list-content").slick("refresh"),window2.localStorage.setItem(STICKER_HISTORY_KEY,JSON.stringify(stickerHistory))},_detectTheme=new WeakSet,detectTheme_fn=function(){switch(__privateGet(this,_options).theme){case"light":case"dark":break;default:$('html[data-theme="dark"]').length?__privateGet(this,_options).theme="dark":__privateGet(this,_options).theme="light"}},_stickerHtml=new WeakSet,stickerHtml_fn=function(stickerData,stickerDetailData){let indexhtml="",html="",stickerHistory=JSON.parse(window2.localStorage.getItem(STICKER_HISTORY_KEY)||"[]");html+='<div class="sticker-content"><ul class="sticker-list row">',stickerHistory.forEach(data=>{let stickerinfo=stickerDetailData[data.sticker_group];if(stickerinfo&&(stickerinfo.deadline>=new Date().getTime()||stickerinfo.deadline==0)){let group=parseInt(data.sticker_group,10),img=parseInt(data.sticker_img,10);if(isNaN(img)||isNaN(group))return;img=img.toString().padStart(2,"0"),html+=__privateMethod(this,_stickerListItemHtml,stickerListItemHtml_fn).call(this,group,img)}}),html+="</ul></div>";let stickerList=[];stickerData.forEach(function(sticker,index){sticker.sticker_visible!=!1&&stickerList.push({key:index,sort:sticker.sticker_order+index/1e5})}),stickerList.sort(function(a,b){return a.sort<b.sort?-1:1});for(let index in stickerList){let skey=stickerList[index].key,stickerinfo=stickerDetailData[skey];if(!stickerinfo)continue;let deadlineDate=new Date(stickerinfo.deadline-1);if(deadlineDate=`${deadlineDate.getFullYear()}/${deadlineDate.getMonth()+1}/${deadlineDate.getDate()}`,indexhtml+=`
<li class="tab-item">
    <a class="sticker-item" href="javascript:;">
        <img src="https://im.bahamut.com.tw/sticker/${skey}/sticker_${skey}.png">
    </a>
</li>`,stickerinfo.deadline>=new Date().getTime()||stickerinfo.deadline==0){html+='<div class="sticker-content"><ul class="sticker-list row">',stickerinfo.stickers.forEach(stickerImage=>{html+=__privateMethod(this,_stickerListItemHtml,stickerListItemHtml_fn).call(this,skey,stickerImage)});let otherInfo="";stickerinfo.sticker_link&&(otherInfo=`<div class="sticker-title__inner">\u76F8\u95DC\u9023\u7D50\uFF1A <a href="${stickerinfo.sticker_link.url}" target="_blank">${stickerinfo.sticker_link.name}</a></div>`);let stickerDeadline=stickerinfo.deadline==0?"\u6C38\u4E45":deadlineDate,stickerAuthor=stickerinfo.sticker_author=="\u5B98\u65B9\u63D0\u4F9B"||stickerinfo.sticker_author=="sysop"?"\u5B98\u65B9\u63D0\u4F9B":`<a href="https://home.gamer.com.tw/${stickerinfo.sticker_author}" target="_blank">${stickerinfo.sticker_author}</a>`;html+=`
    </ul>
    <div class="sticker-title">
        <div class="sticker-title__inner">\u8CBC\u5716\u540D\u7A31\uFF1A ${stickerinfo.sticker_group_name}</div>
        <div class="sticker-title__inner">\u8CBC\u5716\u671F\u9650\uFF1A ${stickerDeadline}</div>
        <div class="sticker-title__inner">\u8CBC\u5716\u4F5C\u8005\uFF1A ${stickerAuthor}</div>
        ${otherInfo}
    </div>
</div>`}else html+=`
<div class="sticker-content">
    <div class="sticker-status">
        <p>\u8CBC\u5716\u671F\u9650\u65BC ${deadlineDate} \u904E\u671F\uFF0C\u5DF2\u7121\u6CD5\u4F7F\u7528\u3002</p>
    </div>
</div>`}return`
<div class="sticker-wrapper">
    <div class="sticker-nav group">
        <ul class="tab-nav mes-sticker-slide sticker-index">
            <li class="tab-item">
                <a class="sticker-item" href="https://home.gamer.com.tw/sticker_store.php" target="_blank">
                    <i class="material-icons">storefront</i>
                </a>
            </li>
            <li class="tab-item">
                <a class="sticker-item is-active" href="javascript:;">
                    <i class="material-icons">access_time</i>
                </a>
            </li>
            ${indexhtml}
        </ul>
    </div>
    <div class="sticker-list-content">
        ${html}
    </div>
</div>`},_stickerListItemHtml=new WeakSet,stickerListItemHtml_fn=function(stickerGroup,stickerImage){return`
<li class="sticker-list__item col-3 col-padding">
    <a class="sticker-list__link" href="javascript:;">
        <img data-sticker-group="${stickerGroup}" data-sticker-image="${stickerImage}" data-lazy="https://im.bahamut.com.tw/sticker/${stickerGroup}/${stickerImage}.png">
    </a>
</li>`},__publicField(_Sticker,"INSERT_TYPE_BAHARTE",1),__publicField(_Sticker,"INSERT_TYPE_HTML",2),__publicField(_Sticker,"INSERT_TYPE_URL",3),__publicField(_Sticker,"INSERT_TYPE_CODE",4);let Sticker=_Sticker,TIPPY_HTML=`
<div class="baha_gif tab-wrapper">
    <ul class="tab-menu tab-menu__3 text-center">
        <li class="tab-menu__item1"><a href="javascript:;">\u8868\u60C5\u7B26\u865F</a></li>
        <li class="tab-menu__item2"><a href="javascript:;">GIF</a></li>
        <li class="tab-menu__item3"><a href="javascript:;">\u8CBC\u5716</a></li>
        <hr>
    </ul>
    <div class="tab-content tab-content_emoji" style="display:none;">
        <div class="emotion-list">`;for(let i=1;i<=43;i++)TIPPY_HTML+=`<img data-src="https://i2.bahamut.com.tw/editor/emotion/${i}.gif" class="lazyload" data-eid="${i}">`,(i==11||i==23||i==33)&&(TIPPY_HTML+="<br>");TIPPY_HTML+=`
        </div>
    </div>
    <div class="tab-content tab-content_gif" style="display:none;">
        <label class="gif-search-box">
            <form class="gif-frm">
                <a href="javascript:;" class="gif-search-icon"><i class="fa fa-search"></i></a>
                <a href="javascript:;" class="clearall"><i class="fa fa-times-circle"></i></a>
                <input type="text" class="gif-search-input" name="q" placeholder="\u641C\u5C0B\u7DB2\u8DEF\u4E0A\u7684 GIF..." autocomplete="off">
            </form>
        </label>
        <div class="gif-wall">
            <div class="trending-gif">
                <h5>\u{1F525}\u71B1\u9580\u52D5\u5716</h5>
                <div class="row masonry js-controlled"></div>
            </div>
            <div class="search-gif" style="display:none;">
                <div class="row masonry js-controlled"></div>
            </div>
            <div class="searching-gif" style="display:none;">
                <div class="row">
                    <img class="lazyload" data-src="https://i2.bahamut.com.tw/addgif_pic.png">
                </div>
            </div>
        </div>
        <div class="add-gif_footer text-center">Powered By Tenor</div>
    </div>
    <div class="tab-content tab-content_sticker" style="display:none;">
    </div>
</div>`,window2.Bahamut=window2.Bahamut||{},window2.Bahamut.Sticker=Sticker})(jQuery,window,window.Dialogify);