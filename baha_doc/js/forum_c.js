(function(a,d){var u={bindEditor:function(){var t=a("#editor").contents();t.on("click",function(){checkIsLogin()}),a("#editor").on("adjustHeight",function(e,o){o!=120?a("#editor").height(o):a("#editor").outerHeight(o)})},onTipsClick:function(){if(checkIsLogin()==!0){var t=bahaRte.isPlainText?bahaRte.source:bahaRte.win;jQuery(t).focus()}},bindOptionMenuTippy:function(){tippy(".tippy-option-menu:not([aria-expanded])",{content:d.document.getElementById("optionMenu").innerHTML,allowHTML:!0,placement:"top",arrow:!0,interactive:!0,hideOnClick:!1,theme:getTippyTheme(),offset:[0,5],duration:240,onShow:t=>{var e=t.popper,o=t.reference,i=a(o).data("tippy");a(e).find("a").eq(1).attr("href",function(){var n="C.php?bsn="+i.bsn+"&snA="+i.snA;return i.readingAuthor?n:n+"&s_author="+i.author}).html(function(){return i.readingAuthor?"\u986F\u793A\u5168\u90E8\u6587\u7AE0":"\u770B\u4ED6\u7684\u6587"}).end().eq(0).off("click").on("click",function(n){t.hide(),FORUM_homeBookmark(i.area,i.bsn,i.sn,i.title,i.dc_c1,i.dc_c2,i.dc_type,i.dc_machine,i.dc_name)}).end().eq(6).off("click").on("click",function(n){t.hide(),accuse_step1(i.bsn,i.sn,"1",i.donateIsOpen)}).end().eq(4).off("click").on("click",function(n){t.hide(),pdel(i.sn)}).end().eq(5).off("click").on("click",function(n){t.hide(),pmodify(i.sn)}).end().eq(7).off("click").on("click",function(n){t.hide(),u.embed(i.title,i.bsn,i.sn)}).end().eq(2).off("click").on("click",function(n){t.hide();const s=`https://forum.gamer.com.tw/Co.php?bsn=${i.bsn}&sn=${i.sn}`;Forum.Common.copyText(s)});let r=a(e).find("a").eq(3);fetch(`https://api.gamer.com.tw/forum/v1/comment_follow_check.php?bsn=${i.bsn}&snB=${i.sn}`,{credentials:"include"}).then(n=>n.json()).then(n=>{if(n.error)throw new Error(n.error.message);n.data.followStatus?r.html("\u53D6\u6D88\u5361\u7559\u8A00"):r.html("\u5361\u7559\u8A00")}).catch(n=>{a(e).find("ul").eq(1).hide()}),r.off("click").on("click",function(){if(d.User&&d.User.Login&&!d.User.Login.requireLogin())return;let n=new Bahamut.Csrf;n.setCookie();let s=new FormData;s.append("bsn",i.bsn),s.append("snB",i.sn),fetch("https://api.gamer.com.tw/forum/v1/comment_follow_toggle.php",{method:"post",body:s,headers:n.getFetchHeaders(),credentials:"include"}).then(l=>l.json()).then(l=>{if(l.error)throw new Error(l.error.message);l.data.followStatus?r.html("\u53D6\u6D88\u5361\u7559\u8A00"):r.html("\u5361\u7559\u8A00")}).catch(l=>{Dialogify.alert(l)})}),i.area=="G2"?(a(e).find("ul").slice(1).hide(),a(e).find("li").slice(1,3).hide()):i.owner&&a(e).find("ul").eq(2).show()||a(e).find("ul").eq(2).hide()}})},bindManageMenuTippy:function(){tippy(".tippy-manage-menu:not([aria-expanded])",{content:d.document.getElementById("manageMenu").innerHTML,allowHTML:!0,placement:"top",arrow:!0,interactive:!0,hideOnClick:!1,theme:getTippyTheme(),duration:240,onShow:t=>{var e=t.popper,o=t.reference,i=a(o).data("tippy");a(e).find("a:eq(0)").off("click").on("click",function(r){t.hide(),del(i.sn)}),a(e).find("a:eq(1)").off("click").on("click",()=>{t.hide(),u.grade(i.bsn,[i.sn],i.grade15)}),a(e).find("a:eq(2)").off("click").on("click",function(r){t.hide(),Dialogify.confirm("\u6C34\u6876\u540C\u6642\u8ACB\u6CE8\u610F\u6587\u7AE0\u662F\u5426\u9700\u8981\u522A\u9664\uFF0C\u78BA\u5B9A\u8981\u6C34\u6876\u4E86\u55CE\uFF1F",{ok:function(){FORUM_water(i.bsn,i.author,"1","https://forum.gamer.com.tw/Co.php?bsn="+i.bsn+"&sn="+i.sn)}})}),a(e).find("a:eq(3)").off("click").on("click",function(r){t.hide(),M(i.sn)}),a(e).find("a:eq(4)").off("click").on("click",function(r){t.hide(),gather(i.sn)}),a(e).find("a:eq(5)").off("click").on("click",function(r){t.hide(),location.href="BMADMIN/index.php?bsn="+i.bsn+"&p="+i.parent}),i.area=="G2"?a(e).find("ul:eq(0)").hide():(a(e).find("ul:eq(1)").hide(),i.isBM&&a(e).find("li").slice(0,3).show()||a(e).find("li").slice(0,3).hide())}})},bindPostInfoTippy:function(){tippy(".tippy-post-info:not([aria-expanded])",{content:d.document.getElementById("postInfo").innerHTML,allowHTML:!0,placement:"bottom",arrow:!0,interactive:!0,delay:[600,300],theme:getTippyTheme(),hideOnClick:!1,offset:[0,5],duration:240,onShow:t=>{var e=t.reference,o=a(e).data("hideip"),i=a(e).data("mtime");a(t.popper).find("p:eq(0)").text(o).end().find("p:eq(1)").text(i);var r=a(t.popper).find("li:eq(0)");a(e).data("area")=="G2"&&r.hide()||r.show()}})},bindReplyMenuTippy:function(t){var e=a(t||"body").find(".tippy-reply-menu:not([aria-expanded])").get();tippy(e,{content:d.document.getElementById("replyMenu").innerHTML,allowHTML:!0,placement:"bottom-end",arrow:!0,interactive:!0,trigger:"click",theme:getTippyTheme(),animateFill:!1,offset:[0,5],duration:240,onShow:o=>{var i=o.popper,r=o.reference,n=a(r).parents(".c-reply__item").data("comment"),s=a(i).find("a");if(s.removeAttr("style"),a(r).parents(".c-reply__item").find(".content-edit").length){s.off("click").css("color","#999");return}a(i).find("a:eq(2)").off("click").on("click",function(p){if(o.hide(),n.isLogin)return showaccuseCommend(n.bsn,n.snB,n.sn,"1");location.href="https://user.gamer.com.tw/login.php"});var l=a(i).find("a:eq(1)");n.deletable?(l.parent("li").show(),l.off("click").on("click",function(p){return o.hide(),delCommend(n.bsn,n.snB,n.sn)})):l.off("click").parent("li").hide();var c=a(i).find("a:eq(0)");n.editable?(c.parent("li").show(),c.off("click").on("click",function(p){o.hide(),Z(r)})):c.off("click").parent("li").hide()}})},bindSimpleTippy:function(){tippy('.tippy-gpbp:not([data-gtm="\u8D0A\u52A9"]), .usercareer, .userrace, .usergp',{delay:600,duration:240,touch:"hold",theme:"gpbp",allowHTML:!0}),tippy(".tippy-guild-flag",{delay:600,duration:240,touch:"hold",theme:"gpbp"})},bindGpBpListTippy:function(){tippy(".tippy-gpbp-list",{content:'<div id="gpbpList"></div>',allowHTML:!0,placement:"bottom-start",arrow:!0,trigger:"click",theme:getTippyTheme(),interactive:!0,duration:240,maxWidth:"460px",onShow:t=>{a(t.popper).find(".tippy-box").addClass("tippy-gpbp-count"),a(t.popper).find(".tippy-content #gpbpList").html('<img src="https://i2.bahamut.com.tw/mobile/loading.svg">');var e=a(t.reference).data("tippy");S(t.popper,e,1)}})},showDonateHint:function(){if(Cookies.get("ck_forumCDonateShowHint")==="yes")return;let t=a(".buttonbar_dontate").first();if(t.length===0)return;let e=a(`
                <div id="driver-popover-item" style="display: block;">
                    <div class="driver-popover-tip left position-center"></div>
                    <div class="driver-popover-title">\u2606\u2605 \u652F\u6301\u5275\u4F5C X \u7ACB\u5373\u8D0A\u52A9 \u2605\u2606</div>
                    <div class="driver-popover-description">\u900F\u904E\u300C\u8D0A\u52A9\u300D\u652F\u6301\u5275\u4F5C\u8005\u3001\u9F13\u52F5\u597D\u6587\u6301\u7E8C\u8F38\u51FA\uFF01</div>
                    <div class="driver-clearfix driver-popover-footer" style="display: block;">
                        <button class="driver-close-btn driver-close-only-btn">\u6211\u77E5\u9053\u4E86</button>
                    </div>
                </div>
            `);e.css({left:t.get(0).offsetLeft+t.width()+20}).find("button").click(()=>{Cookies.set("ck_forumCDonateShowHint","yes",{expires:365,path:"/",domain:".gamer.com.tw"}),e.hide()}),e.appendTo(t)},bindDonorListTippy:function(){tippy(".tippy-donor-list",{content:'<div id="donorList"></div>',allowHTML:!0,placement:"top",arrow:!0,trigger:"click",theme:getTippyTheme(),interactive:!0,duration:240,maxWidth:"460px",onShow:t=>{a(t.popper).find(".tippy-content #donorList").html('<img src="https://i2.bahamut.com.tw/mobile/loading.svg">');var e=a(t.reference).data("tippy");B(t.popper,e,1)}})},bindArticleFooterButtonHover:function(){a(".article-footer_right-btn").hover(function(){let t=a(this).find("img");t.attr("src",t.data("hover-src"))},function(){let t=a(this).find("img");t.attr("src",t.data("src"))})},bindCommentGpBpListTippy:function(t){t=t||"body";var e=[];a(t).find(".gp-count:not([aria-expanded]), .bp-count:not([aria-expanded])").each(function(){isNaN(parseInt(a(this).text(),10))||e.push(this)}),e.length!=0&&tippy(e,{content:'<div id="gpbpList"></div>',allowHTML:!0,placement:"bottom-start",arrow:!0,trigger:"click",theme:getTippyTheme(),interactive:!0,duration:240,maxWidth:"460px",onShow:o=>{a(o.popper).find(".tippy-content #gpbpList").html('<img src="https://i2.bahamut.com.tw/mobile/loading.svg">');var i=a(o.reference),r=i.hasClass("gp-count")?v:g,n=i.parents(".c-reply__item").data("comment");H(o.popper,r,n,1)}})},bindCommentWarningTippy:function(){tippy(".reply-input:not([aria-expanded])",{trigger:"manual",arrow:!0,hideOnClick:"toggle"})},bindCommentDateTippy:function(t){var e=a(t||"body").find(".reply-content__footer .edittime[data-tippy-content]").get();tippy(e,{trigger:"click",duration:240,theme:"gpbp"})},bindTemplateList:function(){a("#add-template_c").click(function(t){jQuery("#add-demonstratio_box").hide(),jQuery("#add-demonstratio_c").removeClass("is-active");let e="\u767C\u6587\u7A31\u865F",o=jQuery("input[name=demonstratioType]").val(),i=jQuery(`#demonstratio_${o}`);i.length>0&&(e=`\u7A31\u865F\uFF1A${i.text()}`),jQuery("#add-demonstratio_c").html('<i class="fa fa-plus"></i>'),jQuery("#add-demonstratio_c").append(document.createTextNode(e)),jQuery("#add-demonstratio_c").attr("title",e),a("#add-template_box").toggle(),a("#add-template_box").find("img").addClass("lazypreload"),a("#add-template_c").toggleClass("is-active"),a("#add-template_c").hasClass("is-active")?(a("#add-template_c").html('<i class="fa fa-minus"></i>\u95DC\u9589\u7BC4\u672C</button>'),a("#add-template_c").attr("title","\u95DC\u9589\u7BC4\u672C")):(a("#add-template_c").html('<i class="fa fa-plus"></i>\u9078\u64C7\u7BC4\u672C</button>'),a("#add-template_c").attr("title","\u9078\u64C7\u7BC4\u672C"))}),a(".toolbarBtn").click(function(t){a(this).hasClass("add-template_c")==!1&&a("#add-template_c").hasClass("is-active")&&(a("#add-template_box").toggle(),a("#add-template_c").toggleClass("is-active"),a("#add-template_c").html('<i class="fa fa-plus"></i>\u9078\u64C7\u7BC4\u672C</button>'),a("#add-template_c").attr("title","\u9078\u64C7\u7BC4\u672C"))}),tippy(".tippy-template",{content:'<div id="templatePreview"></div>',allowHTML:!0,arrow:!1,animation:"fade",offset:[0,5],placement:"top",theme:getTippyTheme(),onShow:t=>{var e=a(t.reference).find(".c-post__template__item").clone();e.css("display",""),a(t.popper).addClass("tippy-popper-template").find("#templatePreview").html(e)}})},bindDemonstratioList:function(){a("#add-demonstratio_c").click(function(t){jQuery("#add-template_box").hide(),jQuery("#add-template_c").removeClass("is-active"),jQuery("#add-template_c").html('<i class="fa fa-plus"></i>\u9078\u64C7\u7BC4\u672C</button>'),jQuery("#add-template_c").attr("title","\u9078\u64C7\u7BC4\u672C"),a("#add-demonstratio_box").toggle(),a("#add-demonstratio_box").find("img").addClass("lazypreload"),a("#add-demonstratio_c").toggleClass("is-active");let e="\u767C\u6587\u7A31\u865F",o=jQuery("input[name=demonstratioType]").val(),i=jQuery(`#demonstratio_${o}`);i.length>0&&(e=`\u7A31\u865F\uFF1A${i.text()}`),a("#add-demonstratio_c").hasClass("is-active")?a("#add-demonstratio_c").html('<i class="fa fa-minus"></i>'):a("#add-demonstratio_c").html('<i class="fa fa-plus"></i>'),jQuery("#add-demonstratio_c").append(document.createTextNode(e)),jQuery("#add-demonstratio_c").attr("title",e)})},initCommentInput:function(t){var e=a(t).parents(".c-reply__item").length;a(t||".reply-input > .content-edit").click(function(o){var i=a(this).data("snb");q(i),W(this)}).keypress(function(o){if(Cookies.get("BAHAID")){var i=a(this).data("bsn"),r=a(this).data("snb"),n=a(this).data("snc")||0;switch(o.which||o.keyCode){case 13:o.preventDefault(),b?a(o.target._tippy.popper).find(".tag-user.active").click():G(this,i,r,n);break;default:}}}).keydown(function(o){if(Cookies.get("BAHAID"))switch(o.which||o.keyCode){case 38:case 40:b&&(o.preventDefault(),$popper=a(o.target._tippy.popper),R($popper,(o.which||o.keyCode)==38?"-1":"+1"));break;case 27:e&&!b&&u.editCommentCancel(this);break;default:}}).keyup(function(o){if(Cookies.get("BAHAID")){var i=o.which||o.keyCode;i==38||i==40||z(this,i)}}).on("input focus",function(o){N(this,85),F(this)})},showHonor:function(){const t=d.honorData(),e=[3,4],o="avatar1.gamer.com.tw",i="p2.bahamut.com.tw";a(".c-user__honor").each(function(r,n){if(!a(n).data("honors"))return;a(n).data("honors").toString().split(",").forEach(l=>{if(l==""||l==0)return;let c='href="javascript:;"',p=a(n).data("userid");t[l][1]==1&&(e.includes(parseInt(l,10))?c=`href="javascript:showHonorDialog('${p}', ${l})"`:c=`href="https://${o}/switchhonor.php?uid=${p}&htype=${l}" target="_blank"`);let f=`<a ${c}><img src="https://${i}/HOME/honor/${l}.gif${t[l][2]}" title="${t[l][0]}"/></a>`;a(n).append(f)})})},commentFormatter:function(t){t=a(t),t.each(function(e){var o=a(this);if(o.data("formatted")!="yes"){var i=o.parents("[data-comment]").data("comment").content;i=i.replace(/https?:\/\/[!#-&(-;=?-Z\^-~]+/gi,function(r){var n=/^https?:\/\/(?:www\.)?youtube\.com\/(?:watch\?v=|shorts|live\/)([0-9a-zA-Z_-]{11})(?:&(t=[hms0-9]+))?/,s=/^https?:\/\/youtu\.be\/([0-9a-zA-Z_-]{11})(?:\?(t=[hms0-9]+))?/,l=/^https?:\/\/www\.facebook\.com\/(\w+)\/videos\/(\d+)\//,c,p,m=r.replace(/(?:&quot;|&#0?39;|&lt;|&gt;)/g,function(f){var T={"&quot;":'"',"&lt;":"<","&gt;":">","&#039;":"'","&#39;":"'"};return T[f]});return/^https:\/\/[^"'<>]+?\.(?:jpe?g|gif|png|webp)(?:\?w=[0-9]+)?$/i.test(m)?(p='<img class="lazyload" data-src="'+r+'">',/^(?:https:\/\/im\.bahamut\.com\.tw\/sticker\/\d+\/\d+\.png|https:\/\/i2\.bahamut\.com\.tw\/editor\/emotion\/\d+\.gif)/.test(m)||(p=`<a class="photoswipe-image" target="_blank" href="${r}">${p}</a>`)):(c=r.match(n)||r.match(s))?(o.addClass("forum-block"),p='<a class="forum-reply-video" target="_blank" href="https://www.youtube.com/watch?v='+c[1]+(c[2]?"&"+c[2]:"")+'">',p+='<img src="https://i2.bahamut.com.tw/icon_videoplayer.svg">',p+='<div style="width: 120px; height: 90px; background-image: url(https://img.youtube.com/vi/'+c[1]+'/default.jpg);"></div></a>'):(c=r.match(l))?(o.addClass("forum-block"),p='<a class="forum-reply-video" target="_blank" href="https://www.facebook.com/'+c[1]+"/videos/"+c[2]+'/">',p+='<img src="https://i2.bahamut.com.tw/icon_videoplayer.svg">',p+='<div style="width: 120px; height: 90px; background-image: url(https://graph.facebook.com/'+c[2]+'/picture); background-position: center;"></div></a>'):p='<a target="_blank" onclick="Forum.C.refurl(this);" href="'+r+'">'+r+"</a>",p}),i=i.replace(/(^|\s+)#([0-9]+)/g,function(r,n,s){var l=d.location.search.match(/bsn=([0-9]+)/),c=d.location.search.match(/snA=([0-9]+)/);if(l&&c){var p=n+'<a href="https://forum.gamer.com.tw';return p+=d.location.pathname,p+="?bsn="+l[1]+"&snA="+c[1]+"&to="+s+'">#'+s+"</a>",p}return r}),i=i.replace(/\[([a-zA-Z][a-zA-Z0-9]{1,11}):([^\]]*)\]/g,function(r,n,s){return'<a target="_blank" href="https://home.gamer.com.tw/'+n+'">'+s+"</a>"}),i=i.replace(/\#(B\d+):(\d+)\#/g,function(r,n,s){let l=o.parent().closest('[name="comment_parent"]').data("comment");var c=n+"("+l[n]+")";return l[n]==null&&(c=n),'<a href="javascript:Forum.C.openCommentDialog('+l.bsn+", "+l.snB+","+s+');">'+c+"</a>"}),o.attr("data-formatted","yes").html(i)}})},openCommentDialog:function(t,e,o){var i={bsn:t,snB:e,snC:o,type:"pc"};a.ajax({url:"https://api.gamer.com.tw/forum/v1/comment_get.php",method:"get",data:i,dataType:"json",xhrFields:{withCredentials:!0}}).done(function(r){if(r.error){toastr.warning(r.error.message,"",{tapToDismiss:!0});return}let n=a(r.data.comment.html);n.find(".buttonbar").remove(),n.find(".tippy-reply-menu").remove();let s="Dialog_"+n.prop("id");n.prop("id",s),new Dialogify(n.prop("outerHTML")).showModal(),u.commentFormatter("#"+s+" .reply-content__article > span")})},refurl:function(t){t.href.match(/^https?:\/\/ref\.gamer\.com\.tw/)||(t.href="https://ref.gamer.com.tw/redir.php?url="+encodeURIComponent(t.href))},dockedTitle:function(){var t=a(".BH-menu"),e=a("#BH-wrapper"),o=a(".c-fixed--header"),i=a(".c-fixed--header .c-menu"),r=a(".TOP-data").height(),n=t.outerHeight(),s=Math.max(t.offset().top-r,0),l=t.outerHeight(!0);t.addClass("box-shadow__soft"),a(".bh-banner").height()==0&&(l+=r);var c=0;t.hasClass("fixed")&&(t.removeClass("fixed").removeAttr("style"),e.css("marginTop",0),s=Math.max(t.offset().top-r,0),t.addClass("fixed"),t.css("top",r-n),t.removeClass("box-shadow__soft"),e.css("marginTop",l),o.show(),i.addClass("is-scroll is-switch"));var p=function(){var m=a(d).scrollTop();m>s&&!t.hasClass("fixed")?(t.addClass("fixed"),o.show(),i.addClass("is-scroll is-switch")):m<=s&&t.hasClass("fixed")&&(t.removeClass("fixed").removeAttr("style"),o.hide(),i.removeClass("is-scroll is-switch")),t.hasClass("fixed")&&(c>m&&!i.hasClass("is-switch")?(t.css("top",r),t.addClass("box-shadow__soft"),i.addClass("is-switch")):c<m&&i.hasClass("is-switch")&&(t.css("top",r-n),t.removeClass("box-shadow__soft"),i.removeClass("is-switch"))),c=m};a(function(){n=t.outerHeight(),a(d).off("scroll",BahamutMenu.onScroll).on("scroll",p),p()})},elevator:function(t,e,o){if(t=t||d.event,t.keyCode==13){var i=parseInt((t.target||t.srcElement).value,10);if(!isNaN(i))if(a("[data-floor="+i+"]").length){var r=a("[data-floor="+i+"]:visible").parents(".c-post, .c-disable"),n=r.offset().top-130;jQuery("html, body").scrollTop(n),r.css("animation","2s highlight")}else{var s=d.location;s.href="https://"+s.host+s.pathname+"?bsn="+e+"&snA="+o+"&to="+i}}},toggleDisplayImage:function(){Cookies.get("ckForumShrinkMedia")=="yes"?(Cookies.remove("ckForumShrinkMedia",{domain:"gamer.com.tw"}),Forum.Common.expandAll(),a(".BH-menu-forumA-right.dropList dl dd:nth-last-child(2) a").text("\u95DC\u9589\u5716\u7247\u5F71\u7247")):(Cookies.set("ckForumShrinkMedia","yes",{expires:365,domain:"gamer.com.tw"}),d.location.reload())},tourC:function(){if(!D()){var t=new Shepherd.Tour({defaults:{classes:"shepherd-theme-arrows",showCancelLink:!0}});t.on("start",function(){I()}),t.on("complete",function(){k(),d.scroll({top:0,left:0,behavior:"smooth"})}),t.on("cancel",function(){k()});var e=[{text:"\u6587\u4E2D\u7684\u201D\u5716\u7247\uFF0F\u5F71\u7247\u201D\u60F3\u9810\u8A2D \u958B \u6216 \u95DC\uFF1F<br>\u5716\u7247\u958B\u95DC\uFF0C\u65B9\u4FBF\u4F60\u96A8\u5FC3\u6240\u6B32\u81EA\u7531\u5207\u63DB\u3002",attachTo:{element:".btn-loadpic",on:"bottom"},title:"\u5716\u7247\u958B\u95DC",buttons:{text:"\u6211\u77E5\u9053\u4E86",action:t.next},scrollTo:!0,scrollToHandler:function(){d.scroll({top:0,left:0,behavior:"smooth"})}},{text:"\u4E0D\u7BA1\u662F\u201D\u770B\u4ED6\u7684\u6587\u3001\u6536\u85CF\u6587\u7AE0\u3001\u6AA2\u8209\u9055\u898F\u201D<br>\u9084\u662F\u201D\u7DE8\u8F2F\u3001\u522A\u9664\u201D\u81EA\u5DF1\u7684\u6587\u7AE0\uFF0C\u5168\u6536\u7D0D\u5728\u201D\u9EDE\u9EDE\u9EDE\u201D\u3002",attachTo:{element:".tippy-option-menu",on:"right"},title:"\u55AE\u7BC7\u66F4\u591A\u529F\u80FD\u201C\u9EDE\u9EDE\u9EDE",buttons:{text:"\u6211\u77E5\u9053\u4E86",action:t.next},scrollTo:!0,scrollToHandler:function(){d.scroll({top:a(".tippy-option-menu:first").offset().top-240,left:0,behavior:"smooth"})}},{text:"1. \u8F38\u5165\u6307\u5B9A\u6A13\u6578\uFF0C\u300C\u96FB\u68AF\u300D\u5C31\u80FD\u5E36\u4F60\u5FEB\u901F\u524D\u5F80\uFF01<br>2. \u8FD4\u56DE\u6587\u7AE0\u5217\u8868<br>3. \u56DE\u9801\u9762\u4E0A\u65B9",attachTo:{element:".jumpfloor",on:"left"},title:"\u5E38\u99D0\u52D5\u7DDA",buttons:{text:"\u6211\u77E5\u9053\u4E86",action:t.next},when:{show:function(){a(".c-fixed--header:visible").length>0&&t.addStep("stepFixedHeader",{text:"\u8A0E\u8AD6\u4E32\u529F\u80FD\u7F6E\u9802\u986F\u793A\uFF0C\u8B93\u4F60\u4E0D\u7BA1\u770B\u5230\u54EA\uFF0C\u90FD\u80FD\u96A8\u6642\u4F7F\u7528\u3002<br>\u9019\u88E1\u4E5F\u6709\u5716\u7247\u958B\u95DC\u5537\uFF01",attachTo:".c-fixed--header bottom",title:"\u7F6E\u9802\u6A19\u984C\u5DE5\u5177\u5217",buttons:{text:"\u6211\u77E5\u9053\u4E86",action:t.next}})}}},{text:"1. \u514D\u63DB\u9801\uFF0C\u5FEB\u901F\u56DE\u6587\u6700\u65B9\u4FBF\u3002<br>2. \u9023\u7D50\uFF0F\u5716\u7247\u9023\u7D50\uFF0F\u5F71\u7247\u9023\u7D50\u7686\u53EF\u7121\u8166\u8CBC\u4E0A\uFF0C\u4E0D\u9700\u8981\u53E6\u5916\u63D2\u5165\u3002<br>3. \u5BEB\u5230\u54EA\u7DE8\u5230\u54EA\uFF0C\u5C07\u6587\u5B57\u53CD\u767D\u5373\u53EF\u76F4\u63A5\u986F\u793A\u529F\u80FD\u9078\u9805\u3002",attachTo:{element:".c-editor",on:"top"},title:"\u5FEB\u901F\u56DE\u8986\u5340\u76F4\u89BA\u5F0F\u7DE8\u8F2F",buttons:{text:"\u6211\u77E5\u9053\u4E86",action:t.next},scrollTo:!0,scrollToHandler:function(){d.scroll({top:a(".c-editor__input:first").offset().top-240,left:0,behavior:"smooth"})}}];if(e.length>0){for(var o in e)a(e[o].attachTo.element).length&&t.addStep("step"+(o+1),e[o]);t.start()}}},tagUser:function(t,e,o,i){b&&w.hide();var r="textarea[data-snb="+t+"]";r+=i?"[data-snc="+i+"]":":not([data-snc])";var n=a(r).get(0);n.focus();var s=n.value.lastIndexOf("@",n.selectionStart);s==-1&&(s=n.selectionStart);var l=n.selectionEnd,c=n.value.substring(0,s),p=n.value.substring(l,n.value.length);o=o.replace("[","&#91;").replace("]","&#93;"),n.value=c+"["+e+":"+o+"]"+p,s=n.value.length-p.length,n.setSelectionRange(s,s),F(n)},replyToFloor:function(t,e,o){if(!(o==null||o==0)){var i="textarea[data-snb="+t+"]";i+=":not([data-snc])";var r=a(i).get(0);r.focus();var n=r.value.lastIndexOf("@",r.selectionStart);n==-1&&(n=r.selectionStart);var s=r.selectionEnd,l=r.value.substring(0,n),c=r.value.substring(s,r.value.length);r.value=l+"#B"+o+":"+e+"# "+c,n=r.value.length-c.length,r.setSelectionRange(n,n),F(r)}},commentGp:function(t){var e=a(t).parents(".c-reply__item").data("comment");j(t,v,e)},commentBp:function(t){var e=a(t).parents(".c-reply__item").data("comment");j(t,g,e)},commentRestoreGpBp:function(t,e,o){var i=t+"_"+e+"_"+o;toastr.clear(y[i],{force:!0}),delete y[i],getCSRFToken().done(function(r){var n={token:r,bsn:t,snB:e,snC:o};a.post("/ajax/comment_restore_gpbp.php",n,function(s){if(s.message){toastr.warning(s.message,"",{tapToDismiss:!0});return}O(s.type,s.snC,-1),toastr.info("\u60A8\u7684\u52D5\u4F5C\u5DF2\u5FA9\u539F","",{tapToDismiss:!0})})})},unfoldComment:function(t){a(t).parent().next().show(400).end().remove()},editCommentCancel:function(t){var e=a(t).parents(".c-reply__item");e.find(".reply-input").get(0)._tippy.hide(),e.find(".reply-content").html(C),u.bindCommentGpBpListTippy(e),u.bindCommentDateTippy(e)},insertImage:function(t){if(!(d.User&&d.User.Login&&!d.User.Login.requireLoginIframe())){t instanceof HTMLElement?t=a(t).parents(".reply-input").find("textarea"):t="#editor";var e=new Bahamut.TruthImage({action:Bahamut.TruthImage.ACTION_FORUM_INSERT,bsn:+new URL(d.location.href).searchParams.get("bsn")});e.setEditor(t),e.showDialog()}},showAd:function(t,e){let o="/1017768/AD_desktopweb_forum_c_article_banner",i="/1017768/AD_desktopweb_forum_c_article_banner_2",r="ad-native-c",n="ad-native-c-2",s=[[728,90]],l=`
                <section class="c-section" style="display:none;">
                    <div class="c-section__main">
                        <div class="c-post__header" id="${r}" style="padding-left:18px; padding-top:2px; margin-bottom:0px;">
                        </div>
                    </div>
                </section>
            `,c=`
                <section class="c-section" style="display:none;">
                    <div class="c-section__main">
                        <div class="c-post__header" id="${n}" style="padding-left:18px; padding-top:2px; margin-bottom:0px;">
                        </div>
                    </div>
                </section>
            `;googletag.cmd.push(function(){a(".c-section[id^=post_]:eq(0)").after(l);let p=[];p.push(googletag.defineSlot(o,s,r).addService(googletag.pubads()).setTargeting("bsn",e).setTargeting("service","forum")),a(".c-section[id^=post_]:eq(1)").length&&(a(".c-section[id^=post_]:eq(1)").after(c),p.push(googletag.defineSlot(i,s,n).addService(googletag.pubads()).setTargeting("bsn",e).setTargeting("service","forum")));let m=Cookies.get("BAHALV")||"";if(m)for(const f of p)f.setTargeting("LV",m);if(Util.Theme.Dark.applying())for(const f of p)f.setTargeting("Theme","dark");d.DFP.setTargeting(),googletag.pubads().addEventListener("slotRenderEnded",function(f){if(f.slot.getSlotElementId()==r||f.slot.getSlotElementId()==n){let T=a("#"+f.slot.getSlotElementId()).parents("section.c-section");f.isEmpty?T.remove():T.fadeIn(200)}}),googletag.enableServices();for(const f of p)googletag.display(f)})},embed:function(t,e,o){var i="https://forum.gamer.com.tw/embed.php?bsn="+e+"&sn="+o,r='<h1 class="re-c-post__header__title postembed__title">'+t+"</h1>";r+='<div class="postembed-url">',r+='<div class="input-box">',r+='<a href="" class="clearall"></a>',r+='<textarea id="embedCode" type="text" class="form-control" readonly>&lt;iframe src="'+i+'" width="100%" height="350" frameborder="0" allowtransparency="true"&gt;&lt;/iframe&gt;</textarea>',r+="</div>",r+='<iframe id="embedPreview" src="'+i+'&preview" width="100%" height="350" frameborder="0" allowtransparency="true"></iframe></div>',new Dialogify(r,{dialog:{style:{width:"540"}}}).title("\u6587\u7AE0\u5D4C\u5165\u78BC").buttons([{type:Dialogify.BUTTON_PRIMARY,text:"\u8907\u88FD\u4EE3\u78BC",click:function(n){d.document.querySelector("#embedCode").select(),Forum.Common.copyText(d.document.querySelector("#embedCode").value)}}]).showModal()},donate:function(t,e,o,i,r=!1){d.donateDialog||(d.donateDialog={}),d.donateDialog[`${e}_${i}`]?d.donateDialog[`${e}_${i}`].reopenDialog():(d.donateDialog[`${e}_${i}`]=new Bahamut.Donate({area:"forum",bsn:e,snA:o,snB:i},{onDonateSuccess:V,anonymousOnly:r,loginReturnUrlParameter:`#donate${i}`}),d.donateDialog[`${e}_${i}`].init())},gotoPostPage:function(t,e,o,i=0){let r=a("<form></form>");if(r.attr("method","post"),i===0?r.attr("action",`post1.php?bsn=${t}&type=2&snA=${e}&subbsn=${o}`):r.attr("action",`post1.php?bsn=${t}&type=2&snA=${e}&subbsn=${o}&sn=${i}&re=1`),text=bahaRte.convertor.toText(bahaRte.doc.body.innerHTML),text.trim()===""||text.trim()=="[div][/div]"||text=="[div] [/div]"||text==`[div]
[/div]`){a("body").append(r),r.submit();return}if(text.replace(/\r?\n/g,`\r
`).utf8Length()>bahaRte.constants.maxContentLength){Dialogify.alert("\u5DF2\u8D85\u904E\u5B57\u6578\u4E0A\u9650!");return}let s=a("<input></input>");s.attr("type","hidden"),s.attr("name","CPageContent"),s.attr("value",text),r.append(s),a("body").append(r),r.submit()},toggleThreadFollow:function(t,e){let o=new Bahamut.Csrf;o.setCookie();let i=new FormData;i.append("bsn",t),i.append("snA",e),fetch("https://api.gamer.com.tw/forum/v1/thread_follow_toggle.php",{method:"post",body:i,headers:o.getFetchHeaders(),credentials:"include"}).then(r=>r.json()).then(r=>{if(r.error)throw new Error(r.error.message);r.data.followStatus?toastr.success(r.data.message,"",{positionClass:"toast-bottom-center"}):toastr.warning(r.data.message,"",{positionClass:"toast-bottom-center"})}).catch(r=>{Dialogify.alert(r.message)})},grade(t,e,o){let i=` data-bsn="${t}" data-sns="${e.join(",")}"`;const n=`
<div class="subscription-list subscription-list__wrap">
    <ul class="subscription-list__row">
        <li>
            <p class="article-grading__title">\u95B1\u89BD\u5206\u7D1A\uFF1A\u5152\u5C11\u4FDD\u8B77</p>
            <div class="BH-menu__switch-box${o?" is-on":""}"${i}>
                <label class="BH-menu__switch-box__option">
                    <span class="BH-menu__switch-box__active-state">ON</span>
                    <div class="BH-menu__switch-box__icon"></div>
                    <span class="BH-menu__switch-box__inactive-state">OFF</span>
                </label>
            </div>
        </li>
        <li class="article-grading">
            <p class="article-grading__msg">\u54C8\u5566\u5340\u662F\u4E00\u500B\u516C\u958B\u7684\u666E\u7D1A\u8A0E\u8AD6\u5E73\u53F0\u3002</br>\u8ACB\u6839\u64DA<a target="_blank" href="https://forum.gamer.com.tw/C.php?bsn=60096&snA=11291" class="rule-link">\u5206\u7D1A\u898F\u5B9A</a>\u5224\u5B9A\u6587\u7AE0\u5167\u5BB9\u662F\u5426\u9069\u5408\u5152\u5C11\u89C0\u770B\uFF0C\u8996\u9700\u8981\u8ABF\u6574\u6587\u7AE0\u5206\u7D1A\u8A2D\u5B9A\u3002</p>
        </li>
    </ul>
</div>`;new Dialogify(n).title("\u6587\u7AE0\u95B1\u89BD\u5206\u7D1A").buttons([{text:"\u53D6\u6D88",click:function(){this.close()}},{text:"\u9001\u51FA",type:Dialogify.BUTTON_PRIMARY,click:async function(){const s=new Bahamut.Csrf;s.setCookie();const l=this.$content.find(".BH-menu__switch-box"),c=new FormData;c.append("grade",l.hasClass("is-on")?2:1),c.append("bsn",l.data("bsn")),String(l.data("sns")).split(",").forEach(m=>{c.append("sns[]",m)});try{const f=await(await fetch("https://api.gamer.com.tw/forum/v1/bm_post_grade.php",{method:"post",body:c,headers:s.getFetchHeaders(),credentials:"include"})).json();if(f.error)throw new Error(f.error.message);d.location.reload()}catch(m){Dialogify.alert(m.message)}}}],{position:Dialogify.BUTTON_CENTER}).on("show",function(){this.$content.find(".subscription-list__row > li:first-child").on("click",()=>{this.$content.find(".BH-menu__switch-box").toggleClass("is-on")})}).showModal()}};const v=1,g=2;var h={},y={},w=null,b=!1,C,_={content:'<div class="tag-list"><img src="https://i2.bahamut.com.tw/mobile/loading.svg"></div>',allowHTML:!0,placement:"bottom",trigger:"manual",interactive:!0,theme:getTippyTheme(),zIndex:2,sticky:!0,onShow:t=>{b=!0;var e=t.reference;Q(e)},onShown:t=>{var e=t.reference;e.focus()},onHide:t=>{b=!1}};if(d.Quill){var x=Quill.import("attributors/style/size");x.whitelist=["13px","18px","24px","32px"],Quill.register(x,!0)}function I(){a("<div />").addClass("tour-overlay").attr("id","tourOverlay").appendTo("body")}function k(){a("#tourOverlay").remove()}function D(){return/bot|googlebot|crawler|spider|robot|crawling/i.test(d.navigator.userAgent)}function L(t){var e=/^https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([0-9a-zA-Z_-]{11})(?:.*(?:&(?:t|time_continue)=(\d+)))?/,o=/^https?:\/\/youtu\.be\/([0-9a-zA-Z_-]{11})(?:.*(?:(?:&|\?)(?:t|time_continue)=(\d+)))?/,i=/^https?:\/\/(?:www\.)?youtube\.com\/(?:shorts|live)\/([0-9a-zA-Z_-]{11})/,r=/^https?:\/\/www\.twitch\.tv\/([a-zA-Z0-9_-]+)/,n=/^https?:\/\/www\.twitch\.tv\/videos\/([0-9]+)/,s=/^https?:\/\/vlog\.xuite\.net\/play\/([a-zA-Z0-9+\/=]+)/,l=/^https?:\/\/www\.nicovideo\.jp\/watch\/((?:sm|nm|ca|cd|ax|yo|nl|ig|na|cw|za|zb|zc|zd|ze|om|sk|yk|so|am|fz)[0-9]{1,14}|[0-9]{10})/,c=/^https:\/\/livehouse\.in\/channel\/(\w+)/,p=/^https:\/\/www\.facebook\.com\/(\w+)\/videos\/(\d+)\//,m;if(m=t.match(e)||t.match(o)||t.match(i)){var f="https://www.youtube.com/watch?v="+m[1];return m[2]&&(f+="&t="+m[2]),f}else{if(m=t.match(n))return null;if(m=t.match(r)||t.match(s)||t.match(l)||t.match(c)||t.match(p))return m[0]}return null}function S(t,e,o){a.ajax({type:"GET",url:"/ajax/GPBPlist.php",data:{t:e.type,bsn:e.bsn,snB:e.sn,p:o},dataType:"json",success:function(i){var r=a(t).find(".tippy-content #gpbpList"),n,s;if(i.status=="F")r.text(i.msg);else{var l=JSON.parse(i.u),c="";for(var p in l)c+='<a target="_blank" href="https://home.gamer.com.tw/'+p+'">',c+='<img class="gamercard" data-gamercard-userid="'+p+'" src="'+l[p].avatar+'"></a>';i.page&&(c+='<div class="buttons">',i.page.p&&(n=function(){S(t,e,i.page.p)},c+='<button id="gpbpListPrev" type="button" class="btn--sm btn--normal">\u4E0A\u4E00\u9801</button>'),i.page.n&&(s=function(){S(t,e,i.page.n)},c+='<button id="gpbpListNext" type="button" class="btn--sm btn--normal">\u4E0B\u4E00\u9801</button>'),c+="</div>"),r.html(c)}a(t).find("#gpbpListPrev").off("click").on("click",n||function(){}),a(t).find("#gpbpListNext").off("click").on("click",s||function(){})}})}function B(t,e,o){let i=`${e.bsn}_${e.snB}`;fetch(`https://api.gamer.com.tw/donate/v1/donor_list.php?donation_id=${i}&page=${o}&area=forum`,{credentials:"include"}).then(r=>r.json()).then(r=>{if(r.error)throw new Error(r.error.message);let n=a(t).find(".tippy-content #donorList");if(parseInt(r.data.totalItemNum,10)==0){n.html("\u8D0A\u52A9\u652F\u6301\u4ED6\u6301\u7E8C\u8F38\u51FA\uFF01");return}let s=`<div class="donate-list">
              <h5>
                <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/PjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iJiN4NTcxNjsmI3g1QzY0O18xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDEyIDEwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxMiAxMDsiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxyZWN0IHk9IjEiIHN0eWxlPSJmaWxsOiM4RDhEOEQ7IiB3aWR0aD0iMyIgaGVpZ2h0PSIzIi8+PHJlY3QgeT0iNyIgc3R5bGU9ImZpbGw6IzhEOEQ4RDsiIHdpZHRoPSIzIiBoZWlnaHQ9IjMiLz48cmVjdCB4PSIzIiB5PSI0IiBzdHlsZT0iZmlsbDojOEQ4RDhEOyIgd2lkdGg9IjMiIGhlaWdodD0iMyIvPjwvZz48L3N2Zz4=">
                \u9019\u4E9B\u52C7\u8005\u89BA\u5F97\u4E0D\u8D0A\u4E0D\u884C
              </h5>`,l=(o-1)*parseInt(r.data.pageRows,10)+1;r.data.donorList.forEach(m=>{let f="";l<=3&&(f=`no0${l}`),s+=`<div class="donate-list-item"><div><span>${l}</span>`,m.lowerUserid==="sysop"?(s+=`<a class="${f}">`,s+=`<img src="${m.avatar}">`,s+="<p>\u795E\u79D8\u8D0A\u52A9\u8005<small>&nbsp;</small></p></a></div></div>"):(s+=`<a class="${f}" target="_blank" href="https://home.gamer.com.tw/${m.lowerUserid}">`,s+=`<img class="gamercard" data-gamercard-userid="${m.lowerUserid}" src="${m.avatar}">`,s+=`<p>${m.nick}<small>${m.lowerUserid}</small></p></a></div></div>`),l+=1}),s+='<div class="buttons">';let c=null,p=null;o>1&&(c=()=>B(t,e,o-1),s+='<button id="donorListPrev" type="button" class="btn--sm btn--normal">\u4E0A\u4E00\u9801</button>'),o<parseInt(r.data.totalPage,10)&&(p=()=>B(t,e,o+1),s+='<button id="donorListNext" type="button" class="btn--sm btn--normal">\u4E0B\u4E00\u9801</button>'),s+="</div>",n.html(s),a(t).find("#donorListPrev").off("click").on("click",c||function(){}),a(t).find("#donorListNext").off("click").on("click",p||function(){})}).catch(r=>{Dialogify.alert("\u7CFB\u7D71\u5FD9\u788C\u4E2D"),console.error(r)})}function H(t,e,o,i){var r={bsn:o.bsn,snB:o.snB,snC:o.sn,t:e,p:i};a.get("/ajax/comment_gpbp_list.php",r,function(n){var s=a(t).find(".tippy-content #gpbpList"),l,c;if(n.message)s.text(n.message);else{var p=n.list,m="";for(var f in p)m+='<a target="_blank" href="https://home.gamer.com.tw/'+p[f].userid+'">',m+='<img class="gamercard" data-gamercard-userid="'+p[f].userid+'" src="'+p[f].avatar+'"></a>';(n.next||n.prev)&&(m+='<div class="buttons">',n.prev&&(l=function(){H(t,e,o,n.prev)},m+='<button id="gpbpListPrev" type="button" class="btn--sm btn--normal">\u4E0A\u4E00\u9801</button>'),n.next&&(c=function(){H(t,e,o,n.next)},m+='<button id="gpbpListNext" type="button" class="btn--sm btn--normal">\u4E0B\u4E00\u9801</button>'),m+="</div>"),s.html(m)}a(t).find("#gpbpListPrev").off("click").on("click",l||function(){}),a(t).find("#gpbpListNext").off("click").on("click",c||function(){})})}function z(t,e){var o=t.value.lastIndexOf("@",t.selectionStart);o==-1?o=t.selectionStart:o>0&&o--;var i=t.value.substring(o,t.selectionEnd);if(!i.match(/^ ?@$/)||b){b&&(e==27||[8,33,34,35,36,37,39].indexOf(e)!=-1&&!i.match(/^ ?@.*$/)?w.hide():[16,17,18].indexOf(e)==-1&&A(t));return}var r=getCaretCoordinates(t,t.selectionEnd),n=r.left-a(t).width()/2;_.offset=[n,0],_.appendTo=d.document.body,w=tippy(t,_),w.show()}function E(t,e,o){return`
<li>
  <a class="tag-user" href="javascript:;" onclick="Forum.C.tagUser(${t}, '${e.userid}', '${e.nickname}', ${o});">
    <div class="userpic">
      <img class="lazyload" data-src="${e.avatar}">
    </div>
    <span class="username">${e.nickname}</span>
  </a>
</li>`}function A(t){if(b){var e=t.value.lastIndexOf("@",t.selectionStart);if(e!=-1){var o=t.value.substring(e+1,t.selectionEnd).toLowerCase(),i=a(t).data("snb"),r=a(t).data("snc")||0,n="post_"+i,s="",l="";for(var c in h[n]){var p=h[n][c];p.nickname.toLowerCase().indexOf(o)!=-1&&p.userid.toLowerCase()!=Cookies.get("BAHAID").toLowerCase()&&(l+=E(i,p,r))}l&&(l="<h3>\u7559\u8A00\u540D\u55AE</h3><ul>"+l+"</ul>");for(var m in h.friend)h.friend[m].nickname.toLowerCase().indexOf(o)!=-1&&(s+=E(i,h.friend[m],r));s&&(s="<h3>\u597D\u53CB\u540D\u55AE</h3><ul>"+s+"</ul>");var f=a(t._tippy.popper);l||s?f.find(".tag-list").html(l+s):f.find(".tag-list").html("<h3>\u6C92\u6709\u76F8\u7B26\u7684\u540D\u55AE</h3>");var T=f.find(".tag-user");T.mouseenter(function(Y){T.removeClass("active"),a(this).addClass("active")}),setTimeout(function(){R(f,0)},1)}}}function R(t,e){var o=t.find(".tag-user"),i=o.filter(".active"),r,n;if(o.length!=0){if(typeof e=="string"){var s=parseInt(e,10);n=o.index(i)+s,n>=o.length?n=0:n<0&&(n=o.length-1)}else n=e;r=o.filter(":eq("+n+")"),i.removeClass("active"),r.addClass("active");var l=t.find(".tag-list"),c=r.position().top+l.scrollTop()-150+16;l.stop().animate({scrollTop:c},200)}}function Q(t){var e=a(t).data("snb");if(h.friend)P(e),A(t);else{var o={u:Cookies.get("BAHAID")};a.get("/ajax/tag_list_friend.php",o,function(i){i.error?toastr.error(i.error):(h.friend=i,P(e),A(t))})}}function P(t){var e="post_"+t,o={},i=a("#"+e),r=i.find(".c-post__header__author"),n=r.find(".userid").text();o[n.toLowerCase()]={userid:n,nickname:r.find(".username").text(),avatar:U(n)};var s=i.find("#Commendlist_"+t+" div.c-reply__item");s.each(function(){var l=a(this).find(".gamercard"),c=l.data("gamercard-userid");o[c.toLowerCase()]={userid:c,nickname:a(this).find(".reply-content__user").text(),avatar:l.data("src")}}),h[e]=o}function q(t){if(!Cookies.get("BAHAID")){var e=d.location,o="https://"+e.host+e.pathname+e.search+"#reply"+t;Cookies.set("ckFrom",o,{path:"/",domain:".gamer.com.tw"}),e.href="https://user.gamer.com.tw/login.php"}}function F(t){a(t).height(20),a(t).height(t.scrollHeight)}function N(t,e){e*=3;var o=a(t).val(),i=a(t).parents(".reply-input");let r=i.get(0)._tippy;Forum.Common.utf8Length(o)>e?(i.addClass("warning"),r.show()):(i.removeClass("warning"),r.hide())}function U(t){t=t.toLowerCase();var e="https://avatar2.bahamut.com.tw/avataruserpic/";return e+=t.charAt(0)+"/"+t.charAt(1)+"/",e+=t+"/"+t+"_s.png",e}function G(t,e,o,i){var r=255,n=t.value;if(Forum.Common.utf8Length(n)>r){toastr.warning("\u7559\u8A00\u5B57\u6578\u904E\u591A\uFF01"),t.focus();return}else if(n.replace(/(^\s*)|(\s*$)/g,"")==""||n.replace(/ |��/g,"")==""){toastr.warning("\u8ACB\u8F38\u5165\u7559\u8A00"),t.focus();return}var s=i?"/ajax/edit_comment.php":"/ajax/newCommend.php";t.disabled=!0;let l=new Bahamut.Csrf;l.setCookie(),a.ajax({url:s,method:"POST",data:{bsn:e,snB:o,snC:i||0,c:n,returnHtml:1},xhrFields:{withCredentials:!0},headers:l.getJqueryHeaders()}).done(function(c){if(c.errMsg){toastr.error(c.errMsg);return}var p="#Commendcontent_"+c.snC;i?a(p).replaceWith(c.html):a("#Commendlist_"+o).append(c.html),u.bindReplyMenuTippy(p),u.bindCommentGpBpListTippy(p),u.bindCommentDateTippy(p),u.commentFormatter(p+" .reply-content__article > span.comment_content"),t.value=""}).always(function(){t.disabled=!1,t.focus()})}function W(t){var e="FOURM_TOUR_comment";if(!(!Cookies.get("BAHAID")||d.localStorage.getItem(e)=="shown")){var o=new Shepherd.Tour({defaults:{classes:"shepherd-theme-arrows",showCancelLink:!0}});o.on("start",function(){I()}),o.on("complete",function(){k(),t.focus(),d.localStorage.setItem(e,"shown")}),o.on("cancel",function(){k(),t.focus(),d.localStorage.setItem(e,"shown")}),o.addStep("step1",{text:"1. \u9EDE\u64CA\u300C\u56DE\u8986\u300D\u7559\u8A00\u8005\uFF0C\u8B93\u901A\u77E5\u4E0D\u6F0F\u63A5\u3002<br>2. \u8F38\u5165\u300C@\u597D\u53CB\u66B1\u7A31\u300D\uFF0C\u5206\u4EAB\u597D\u6587\u7D66\u5DF4\u54C8\u597D\u53CB\uFF01",attachTo:{element:t,on:"top"},title:"\u7559\u8A00\u6A19\u8A18\u529F\u80FD",buttons:{text:"\u6211\u77E5\u9053\u4E86",action:o.next}}),o.start()}}function j(t,e,o){if(!Cookies.get("BAHAID")){d.location.href="https://user.gamer.com.tw/login.php";return}a(t).prop("disabled",!0),getCSRFToken().done(function(i){var r={token:i,bsn:o.bsn,snB:o.snB,snC:o.sn,t:e};a.post("/ajax/comment_gpbp.php",r,function(n){if(a(t).prop("disabled",!1),n.message){n.code==1?u.commentRestoreGpBp(o.bsn,o.snB,o.sn):toastr.warning(n.message,"",{tapToDismiss:!0});return}var s=n.bsn,l=n.snB,c=n.snC,p=n.type,m="Forum.C.commentRestoreGpBp("+s+", "+l+", "+c+");",f='<a href="javascript:'+m+'" style="float:right;color:yellow;">\u5FA9\u539F</a>';p==v?f="\u52C7\u8005\u7372\u5F97\u4E86 1 \u9EDE\u80FD\u91CF"+f:f="\u52C7\u8005\u524A\u5F31\u4E86 1 \u9EDE\u7CBE\u795E"+f,O(p,c,1),y[s+"_"+l+"_"+c]=toastr.success(f,"",{timeOut:1e4})})})}function O(t,e,o){var i=t==v?"gp":"bp",r=a("#Commendcontent_"+e),n=r.find("."+i+"-count"),s=parseInt(n.data(i),10)||0;s+=o,n.data(i,s),t==v?s>0?(n.text(s),n.hasClass("is-highlight")||n.addClass("is-highlight").prev("button").addClass("is-highlight")):(n.text(""),n.hasClass("is-highlight")&&n.removeClass("is-highlight").prev("button").removeClass("is-highlight")):s<5&&n.text("")||n.text(s),u.bindCommentGpBpListTippy(r)}function Z(t){var e=a(t).parents(".c-reply__item");C=e.find(".reply-content").html();var o=e.data("comment");e.addClass("c-reply__editor").find(".reply-content").empty().html(`
<div class="reply-input" data-tippy-content="\u8D85\u904E85\u500B\u5B57\u4E86\u5594\uFF5E">
  <textarea data-bsn="${o.bsn}" data-snb="${o.snB}" data-snc="${o.sn}" placeholder="\u7559\u8A00\u22EF" class="content-edit"></textarea>
  <div class="comment_icon">
    <a class="gif_box gif_box_emoji" title="\u63D2\u5165\u8868\u60C5\u7B26\u865F\u3001GIF\u3001\u8CBC\u5716" href="javascript:;">
      <img src="https://i2.bahamut.com.tw/forum/icons/comment_emoji.svg" onmouseout="this.src='https://i2.bahamut.com.tw/forum/icons/comment_emoji.svg'" onmouseover="this.src='https://i2.bahamut.com.tw/forum/icons/comment_emoji_active.svg'">
    </a>
    <a title="\u63D2\u5165\u5716\u7247" href="javascript:;" onclick="Forum.C.insertImage(this);"><img src="https://i2.bahamut.com.tw/forum/icons/comment_image.svg"></a>
  </div>
</div>
<div class="reply-content__send">
  <p>\u6309 enter \u9001\u51FA \u6216\u6309 esc <a href="javascript:;" onclick="Forum.C.editCommentCancel(this);">\u53D6\u6D88</a></p>
</div>`);var i=o.content.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&#0?39;/g,"'").replace(/&quot;/g,'"').replace(/https:\/\/[^"'<>]+?\.(?:jpe?g|gif|png|webp)\?w=[0-9]+/gi,function(n){return n.split("?")[0]});e.find(".content-edit").text(i),tippy(e.find(".reply-input").get(0),{trigger:"manual",arrow:!0,hideOnClick:"toggle"});var r=e.find(".content-edit");u.initCommentInput(r),r.focus()}function V(){let t=this.model.anonymous?"\u611F\u8B1D\u533F\u540D\u8072\u63F4\uFF0C\u8B93\u5275\u4F5C\u80FD\u91CF\u751F\u751F\u4E0D\u606F\uFF01":"\u8ACB\u7559\u8A00\u8072\u63F4\u5275\u4F5C\u8005\uFF0C\u8B93\u4ED6\u6301\u7E8C\u8F38\u51FA\uFF01";toastr.success(t,"\u8D0A\u52A9\u5B8C\u6210\uFF01",{positionClass:"toast-bottom-center"});let e=this.model.serviceData,o=`${e.bsn}_${e.snB}`;fetch(`https://api.gamer.com.tw/donate/v1/donor_list.php?donation_id=${o}&area=forum`,{credentials:"include"}).then(i=>{i.json().then(r=>{if(r.error){Dialogify.alert(r.error.message);return}jQuery(`#post_${e.snB} .tippy-donor-list`).text(r.data.totalItemNum)})}).catch(i=>{Dialogify.alert("\u7CFB\u7D71\u5FD9\u788C\u4E2D"),console.error(i)})}d.Forum=d.Forum||{},d.Forum.C=u})(jQuery,window),function(){var a=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],d=typeof window<"u",u=d&&window.mozInnerScreenX!=null;function v(g,h,y){if(!d)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var w=y&&y.debug||!1;if(w){var b=document.querySelector("#input-textarea-caret-position-mirror-div");b&&b.parentNode.removeChild(b)}var C=document.createElement("div");C.id="input-textarea-caret-position-mirror-div",document.body.appendChild(C);var _=C.style,x=window.getComputedStyle?window.getComputedStyle(g):g.currentStyle,I=g.nodeName==="INPUT";_.whiteSpace="pre-wrap",I||(_.wordWrap="break-word"),_.position="absolute",w||(_.visibility="hidden"),a.forEach(function(L){I&&L==="lineHeight"?_.lineHeight=x.height:_[L]=x[L]}),u?g.scrollHeight>parseInt(x.height)&&(_.overflowY="scroll"):_.overflow="hidden",C.textContent=g.value.substring(0,h),I&&(C.textContent=C.textContent.replace(/\s/g,"\xA0"));var k=document.createElement("span");k.textContent=g.value.substring(h)||".",C.appendChild(k);var D={top:k.offsetTop+parseInt(x.borderTopWidth),left:k.offsetLeft+parseInt(x.borderLeftWidth),height:parseInt(x.lineHeight)};return w?k.style.backgroundColor="#aaa":document.body.removeChild(C),D}typeof module<"u"&&typeof module.exports<"u"?module.exports=v:d&&(window.getCaretCoordinates=v)}();function quickPost(a,d,u){var v=document.getElementById("editor"),g=v.contentDocument||v.contentWindow.document,h="";if(bahaRte.isPlainText)h=document.getElementById("source").value;else{let w=g.getElementsByClassName("editstyle");if(w.length<=0){Dialogify.alert("\u8ACB\u586B\u5BEB\u5167\u5BB9");return}h=new Bahacode(w[0]).convert()}jQuery("input[name=rtecontent]").val(h);var y=document.frm;if(u=="60076"&&ruleflag==!1){rulechk(()=>chkdataAndSubmit(y,u));return}chkdataAndSubmit(y,u)}function chkdataAndSubmit(a,d){chkdata(a,d)&&Dialogify.confirm("\u78BA\u5B9A\u767C\u8868?",{ok:function(){bahaRte.onpost=1,window.onbeforeunload=null,a.submit()}})}function insertTemplate(a){Cookies.set("ckForumLastSnippet",a,{expires:365,domain:"gamer.com.tw"});var d=snippetList[a];bahaRte.isPlainText?(bahaRte.source.focus(),bahaRte.utility.insertTextTag(d.content)):(bahaRte.win.focus(),bahaRte.utility.insertHtml(d.content_html)),jQuery("#add-template_box").toggle(),jQuery("#add-template_c").toggleClass("is-active"),jQuery("#add-template_c").html('<i class="fa fa-plus"></i>\u9078\u64C7\u7BC4\u672C</button>'),jQuery("#add-template_c").attr("title","\u9078\u64C7\u7BC4\u672C")}function insertDemonstratio(a,d,u,v){jQuery("input[name=demonstratioType]").val(d),jQuery("#add-demonstratio_box").toggle(),jQuery("#add-demonstratio_c").toggleClass("is-active");let g="\u767C\u6587\u7A31\u865F";if(a!==null){let h=jQuery(a).text();g=`\u7A31\u865F\uFF1A${h}`,window.dataLayer.push({event:"all_click","data-gtm-service":"forum","data-gtm-click":"\u9EDE\u64CA\u7A31\u865F","data-gtm-page":v,"data-gtm-area":"\u5FEB\u56DE\u5340","data-gtm-var1":u,"data-gtm-var2":h})}jQuery("#add-demonstratio_c").html('<i class="fa fa-plus"></i>'),jQuery("#add-demonstratio_c").append(document.createTextNode(g)),jQuery("#add-demonstratio_c").attr("title",g)}function checkIsLogin(){if(Cookies.get("BAHAID"))return!0;var a=window.location,d="https://"+a.host+a.pathname+a.search+"#quickPostAnchor";Cookies.set("ckFrom",d,{path:"/",domain:".gamer.com.tw"}),a.href="https://user.gamer.com.tw/login.php"}function chkdata(a,d){return bahaRte.isEmpty()?(Dialogify.alert("\u8ACB\u586B\u5BEB\u5167\u5BB9"),!1):bahaRte.onpost===1?(Dialogify.alert("\u8655\u7406\u4E2D\uFF0C\u8ACB\u7A0D\u5019"),!1):!0}function delPost(a,d,u){var v=jQuery("#cf"+a).html(),g=/<img .*?src="https?:\/\/truth\.bahamut\.com\.tw\/s01\/[0-9]{6}\/[a-f0-9]{32}\.(?:jpe?g|gif|png|webp)(?:\?[^\?"]*)?"[^>]*?>/i,h=/<a .*?id="https?:\/\/truth\.bahamut\.com\.tw\/s01\/[0-9]{6}\/[a-f0-9]{32}\.(?:jpe?g|gif|png|webp)(?:\?[^\?"]*)?"[^>]*?>/i,y="\u78BA\u5B9A\u8981\u522A\u9664\u55CE\uFF1F";(v.match(g)||v.match(h))&&(y+=`
<br><br>
<div class="check-group">
    <input id="chkDelTruthImage" type="checkbox" value="yes">
    <label for="chkDelTruthImage">
        <div class="label-icon"><i class="fa fa-check"></i></div>
        <h6>\u82E5\u6587\u4E2D\u6709\u6211\u4E0A\u50B3\u81F3\u5DF4\u54C8\u7684\u5716\u7247\u4E5F\u4E00\u4F75\u522A\u9664</h6>
    </label>
</div>`),Dialogify.confirm(y,{ok:function(){jQuery("#chkDelTruthImage:checked").length&&(d+="&dt=yes"),setCookie("ckFORUM_pdel",u),location.href="post2.php?"+d}})}function getTippyTheme(){return jQuery("html").attr("data-theme")=="dark"?"dark":"light"}